!function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(1))},function(e,t,o){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=o(2);o(3);var a=function(e){function t(t){var o=e.call(this,t)||this;o.componentId="",o.flowKey="",o.attributes={},o.selectedItems=[],o.sortItem=null,o.sortDirection=null,o.text="",o.componentId=t.id,o.flowKey=t.flowKey;var n=manywho.model.getComponent(o.props.id,o.props.flowKey);if(n.attributes)for(var r in n.attributes)o.attributes[r]=n.attributes[r];return o}return n(t,e),t.prototype.componentDidMount=function(){this.forceUpdate()},t.prototype.componentDidUpdate=function(){},t.prototype.getAttribute=function(e){return this.attributes[e]?this.attributes[e]:null},t.prototype.render=function(){for(var e,t,o=manywho.model.getComponent(this.componentId,this.flowKey),n=(manywho.state.getComponent(this.componentId,this.flowKey),manywho.model.getOutcomes(this.componentId,this.flowKey)),a=[],i=[],s=0;s<n.length;s++){var l=n[s];if(l.isBulkAction){var c=l.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button";a.push(r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,l.id),title:l.label}))}else switch(l.attributes.action){case"CLICK":t=l.id;break;case"DOUBLE-CLICK":if(0==o.isMultiSelect)e=l.id;else{var c=l.attributes.icon||"log-in",u="glyphicon glyphicon-"+c+" et-button-bar-button";a.push(r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,l.id),title:l.label}))}break;default:if(0==o.isMultiSelect){var c=l.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button",h=r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,l.id),title:l.label});i.push(h)}else{var c=l.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button";a.push(r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,l.id),title:l.label}))}}}var p,m=null;o.label&&o.label.length>0&&(m=r.createElement("span",null,o.label)),p=r.createElement("div",{className:"et-caption-div"},r.createElement("div",{className:"et-caption"},m),r.createElement("div",{className:"et-button-bar"},a));var d,b,f,y=[],g=[],v=[],w=0,I=[];for(o.isMultiSelect&&y.push(r.createElement("td",{className:"et-table-header-checkbox"},r.createElement("input",{className:"et-table-checkbox",type:"checkbox",onClick:this.toggleSelectAll.bind(this)}))),i&&i.length>0&&y.push(r.createElement("td",{className:"et-table-header"})),w=0;w<o.columns.length;w++){var E,O=o.columns[w].developerName;E=this.sortItem&&this.sortItem==O?"DESC"==this.sortDirection?r.createElement("span",{className:"glyphicon glyphicon-arrow-down"}):r.createElement("span",{className:"glyphicon glyphicon-arrow-up"}):null,v[o.columns[w].developerName]=o.columns[w];var N=r.createElement("th",{className:"et-table-header","data-column-name":O,onClick:this.sort.bind(this)},r.createElement("div",null,r.createElement("div",{style:{float:"left"}},r.createElement("span",null,o.columns[w].label)),r.createElement("div",{style:{float:"right"}},E)));y.push(N)}for(w=0;w<o.objectData.length;w++){b=o.objectData[w],f=manywho.utils.getObjectDataProperty(b.properties,this.getAttribute("Row Key")).contentValue,I=[];var C;C=!(this.selectedItems.indexOf(f)<0),o.isMultiSelect?I.push(r.createElement("td",{className:"et-table-cell-checkbox"},r.createElement("input",{className:"et-table-checkbox",type:"checkbox",checked:C,onClick:this.toggleSelectItem.bind(this)}))):I.push(r.createElement("td",{className:"et-table-cell"},i));for(var D=0;D<b.properties.length;D++)(d=v[b.properties[D].developerName])&&d.isDisplayValue&&I.push(r.createElement("td",{className:"et-table-cell"},b.properties[D].contentValue));var u="et-table-row";this.selectedItems&&this.selectedItems.indexOf(f)>=0&&(u+=" et-table-row-selected");var k="";k=1==o.isMultiSelect?"Click to select, Double-Click to open":"Click to select";var x=r.createElement("tr",{className:u,"data-rowId":f,"data-objectData":b,onClick:this.selectRow.bind(this,t),onDoubleClick:this.triggerOutcome.bind(this,e),title:k},I);g.push(x)}var K=r.createElement("div",{className:"et-table-div"},r.createElement("table",{className:"et-table"},r.createElement("thead",{className:"et-table-head"},r.createElement("tr",{className:"et-table-header-row"},y)),r.createElement("tbody",{className:"et-table-body"},g)));return r.createElement("div",{className:"et"},p,K)},t.prototype.triggerOutcome=function(e,t){if(e&&!(e.length<1)){var o,n,r=manywho.model.getComponent(this.componentId,this.flowKey),a=this.getAttribute("Row Key"),i=[];for(var s in this.selectedItems)n=this.getObjectDataByKey(r.objectData,a,this.selectedItems[s]),n=JSON.parse(JSON.stringify(n)),n.isSelected=!0,i.push(n);if(o={objectData:i},manywho.state.setComponent(this.componentId,o,this.flowKey,!0),i&&e){var l=manywho.model.getOutcome(e,this.flowKey);l&&manywho.component.onOutcome(l,null,this.flowKey)}this.forceUpdate()}},t.prototype.sort=function(e){this.sortItem=e.currentTarget.getAttribute("data-column-name"),this.sortDirection&&"ASC"==this.sortDirection?this.sortDirection="DESC":this.sortDirection="ASC",this.forceUpdate()},t.prototype.toggleSelectAll=function(e){if(e.currentTarget.checked)for(var t=manywho.model.getComponent(this.componentId,this.flowKey),o=0;o<t.objectData.length;o++){var n=t.objectData[o],r=manywho.utils.getObjectDataProperty(n.properties,this.getAttribute("Row Key")).contentValue;this.selectedItems.indexOf(r)<0&&this.selectedItems.push(r)}else this.selectedItems=[];return this.forceUpdate(),!1},t.prototype.selectRow=function(e,t){0==manywho.model.getComponent(this.componentId,this.flowKey).isMultiSelect&&(this.selectedItems=[]),this.selectedItems.indexOf(t.currentTarget.getAttribute("data-rowId"))<0&&this.selectedItems.push(t.currentTarget.getAttribute("data-rowId")),this.triggerOutcome(e,t),this.forceUpdate()},t.prototype.toggleSelectItem=function(e){var t=e.currentTarget.getAttribute("data-rowId")||e.currentTarget.parentElement.parentElement.getAttribute("data-rowId");if(this.selectedItems.indexOf(t)<0)this.selectedItems.push(t);else{var o=this.selectedItems.indexOf(t);this.selectedItems.splice(o,1)}e.stopPropagation(),this.forceUpdate()},t.prototype.getObjectDataByKey=function(e,t,o){for(var n,r=0;r<e.length;r++)if(n=e[r],manywho.utils.getObjectDataProperty(n.properties,t).contentValue==o)return n;return null},t}(r.Component);manywho.component.register("EnhancedTable",a),t.default=a},function(e,t){e.exports=React},function(e,t){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vRW5oYW5jZWRUYWJsZS5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMDNlMTBhMDAyN2I3NjE0MjYyYjYiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzeCIsIndlYnBhY2s6Ly8vLi9zcmMvRW5oYW5jZWRUYWJsZS50c3giLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUmVhY3RcIiJdLCJuYW1lcyI6WyJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidmFsdWUiLCJfX2V4dGVuZHMiLCJ0aGlzIiwiZXh0ZW5kU3RhdGljcyIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJiIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIlJlYWN0IiwiRW5oYW5jZWRUYWJsZSIsIl9zdXBlciIsInByb3BzIiwiX3RoaXMiLCJjb21wb25lbnRJZCIsImZsb3dLZXkiLCJhdHRyaWJ1dGVzIiwic2VsZWN0ZWRJdGVtcyIsInNvcnRJdGVtIiwic29ydERpcmVjdGlvbiIsInRleHQiLCJpZCIsImZsb3dNb2RlbCIsIm1hbnl3aG8iLCJtb2RlbCIsImdldENvbXBvbmVudCIsImtleSIsImNvbXBvbmVudERpZE1vdW50IiwiZm9yY2VVcGRhdGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGVOYW1lIiwicmVuZGVyIiwiZGJsQ2xpY2siLCJjbGljayIsIm91dGNvbWVzIiwic3RhdGUiLCJnZXRPdXRjb21lcyIsInRvcGJ1dHRvbnMiLCJyb3dCdXR0b25zIiwib1BvcyIsImxlbmd0aCIsIm91dGNvbWUiLCJpc0J1bGtBY3Rpb24iLCJpY29uIiwiY2xhc3NOYW1lIiwicHVzaCIsImNyZWF0ZUVsZW1lbnQiLCJvbkNsaWNrIiwidHJpZ2dlck91dGNvbWUiLCJiaW5kIiwidGl0bGUiLCJsYWJlbCIsImlzTXVsdGlTZWxlY3QiLCJidXR0b24iLCJsYmwiLCJjb2xEZWYiLCJyb3ciLCJyb3dJZCIsImhlYWRlcnMiLCJyb3dzIiwiY29scyIsInBvcyIsInZhbHMiLCJ0eXBlIiwidG9nZ2xlU2VsZWN0QWxsIiwiY29sdW1ucyIsInNvcnRJY29uIiwiY29sTmFtZSIsImRldmVsb3Blck5hbWUiLCJoZWFkZXIiLCJkYXRhLWNvbHVtbi1uYW1lIiwic29ydCIsInN0eWxlIiwiZmxvYXQiLCJvYmplY3REYXRhIiwidXRpbHMiLCJnZXRPYmplY3REYXRhUHJvcGVydHkiLCJwcm9wZXJ0aWVzIiwiY29udGVudFZhbHVlIiwiY2hlY2tlZCIsImluZGV4T2YiLCJ0b2dnbGVTZWxlY3RJdGVtIiwiaVBvcyIsImlzRGlzcGxheVZhbHVlIiwiciIsImRhdGEtcm93SWQiLCJkYXRhLW9iamVjdERhdGEiLCJzZWxlY3RSb3ciLCJvbkRvdWJsZUNsaWNrIiwidGFibGUiLCJvdXRjb21lSWQiLCJldmVudCIsIm5ld1N0YXRlIiwicm93S2V5RmllbGQiLCJvYmplY3REYXRhQXJyYXkiLCJnZXRPYmplY3REYXRhQnlLZXkiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJpc1NlbGVjdGVkIiwic2V0Q29tcG9uZW50IiwiZ2V0T3V0Y29tZSIsImNvbXBvbmVudCIsIm9uT3V0Y29tZSIsImN1cnJlbnRUYXJnZXQiLCJwYXJlbnRFbGVtZW50IiwiaWR4Iiwic3BsaWNlIiwic3RvcFByb3BhZ2F0aW9uIiwiZmllbGROYW1lIiwib2QiLCJDb21wb25lbnQiLCJyZWdpc3RlciIsImRlZmF1bHQiXSwi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LEVBQVFEIiwiZmlsZSI6IkVuaGFuY2VkVGFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGk6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bDogZmFsc2UsXG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuLyoqKioqKi8gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbi8qKioqKiovIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4vKioqKioqLyBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4vKioqKioqLyBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4vKioqKioqLyBcdFx0XHRcdGdldDogZ2V0dGVyXG4vKioqKioqLyBcdFx0XHR9KTtcbi8qKioqKiovIFx0XHR9XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbi8qKioqKiovIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4vKioqKioqLyBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuLyoqKioqKi8gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbi8qKioqKiovIFx0XHRyZXR1cm4gZ2V0dGVyO1xuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8qKioqKiovIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4vKioqKioqLyB9KVxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKioqKiovIChbXG4vKiAwICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXHJcbmZ1bmN0aW9uIF9fZXhwb3J0KG0pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKCFleHBvcnRzLmhhc093blByb3BlcnR5KHApKSBleHBvcnRzW3BdID0gbVtwXTtcclxufVxyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbl9fZXhwb3J0KF9fd2VicGFja19yZXF1aXJlX18oMSkpO1xyXG5cblxuLyoqKi8gfSksXG4vKiAxICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cblwidXNlIHN0cmljdFwiO1xuXHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbnZhciBSZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMik7XHJcbl9fd2VicGFja19yZXF1aXJlX18oMyk7XHJcbnZhciBFbmhhbmNlZFRhYmxlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEVuaGFuY2VkVGFibGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBFbmhhbmNlZFRhYmxlKHByb3BzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuY29tcG9uZW50SWQgPSBcIlwiO1xyXG4gICAgICAgIF90aGlzLmZsb3dLZXkgPSBcIlwiO1xyXG4gICAgICAgIF90aGlzLmF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICBfdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgICAgX3RoaXMuc29ydEl0ZW0gPSBudWxsO1xyXG4gICAgICAgIF90aGlzLnNvcnREaXJlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgIF90aGlzLnRleHQgPSBcIlwiO1xyXG4gICAgICAgIF90aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IHByb3BzLmZsb3dLZXk7XHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KF90aGlzLnByb3BzLmlkLCBfdGhpcy5wcm9wcy5mbG93S2V5KTtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuZ2V0QXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZU5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIC8vZ2V0IGFsbCBvdXRjb21lcyAtIHRoZXJlJ3MgMiB0eXBlcyAtIHBlciByb3cgYW5kIGJ1bGssIGJ1bGsgZ28gYXMgYnV0dG9ucyBvbiB0b3BcclxuICAgICAgICB2YXIgb3V0Y29tZXMgPSBtYW55d2hvLm1vZGVsLmdldE91dGNvbWVzKHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHRvcGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93QnV0dG9ucyA9IFtdO1xyXG4gICAgICAgIHZhciBkYmxDbGljaztcclxuICAgICAgICB2YXIgY2xpY2s7XHJcbiAgICAgICAgLy9sb29wIG92ZXIgb3V0Y29tZXNcclxuICAgICAgICBmb3IgKHZhciBvUG9zID0gMDsgb1BvcyA8IG91dGNvbWVzLmxlbmd0aDsgb1BvcysrKSB7XHJcbiAgICAgICAgICAgIHZhciBvdXRjb21lID0gb3V0Y29tZXNbb1Bvc107XHJcbiAgICAgICAgICAgIGlmIChvdXRjb21lLmlzQnVsa0FjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy90b3AgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lLCBvbkNsaWNrOiB0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCksIHRpdGxlOiBvdXRjb21lLmxhYmVsIH0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vbXVzdCBiZSBhIHJvdyBidXR0b24sIGl0J3MgYWN0aW9uIGF0dHJpYnV0ZSB3aWxsIHRlbGwgaWYgaXQgc2hvdWxkIGJlIHRoZSBET1VCTEUtQ0xJQ0sgZXZlbnRcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAob3V0Y29tZS5hdHRyaWJ1dGVzW1wiYWN0aW9uXCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNMSUNLXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRPVUJMRS1DTElDS1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NhbnQgaGF2ZSBkb3VibGUgY2xpY2sgZm9yIG11bHRpIHNlbGVjdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRibENsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcImxvZy1pblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wYnV0dG9ucy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIG9uQ2xpY2s6IHRoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKSwgdGl0bGU6IG91dGNvbWUubGFiZWwgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgb25DbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpLCB0aXRsZTogb3V0Y29tZS5sYWJlbCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0J1dHRvbnMucHVzaChidXR0b24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BidXR0b25zLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgb25DbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpLCB0aXRsZTogb3V0Y29tZS5sYWJlbCB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGxhYmVsO1xyXG4gICAgICAgIHZhciBsYmwgPSBudWxsO1xyXG4gICAgICAgIC8vaWYgdGhlIGNvbXBvbmVudCBoYXMgYSBsYWJlbCB0aGVuIHB1dCBpdCBpbiB0aGUgdGl0bGUgYmFyXHJcbiAgICAgICAgaWYgKGZsb3dNb2RlbC5sYWJlbCAmJiBmbG93TW9kZWwubGFiZWwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBsYmwgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCBudWxsLCBmbG93TW9kZWwubGFiZWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2NyZWF0ZSB0aGUgdGl0bGUgYmFyIG9iamVjdFxyXG4gICAgICAgIGxhYmVsID0gUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJldC1jYXB0aW9uLWRpdlwiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXQtY2FwdGlvblwiIH0sIGxibCksXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXQtYnV0dG9uLWJhclwiIH0sIHRvcGJ1dHRvbnMpKTtcclxuICAgICAgICB2YXIgaGVhZGVycyA9IFtdO1xyXG4gICAgICAgIHZhciByb3dzID0gW107XHJcbiAgICAgICAgdmFyIGNvbHMgPSBbXTtcclxuICAgICAgICB2YXIgY29sRGVmO1xyXG4gICAgICAgIHZhciBwb3MgPSAwO1xyXG4gICAgICAgIHZhciByb3c7XHJcbiAgICAgICAgdmFyIHJvd0lkO1xyXG4gICAgICAgIHZhciB2YWxzID0gW107XHJcbiAgICAgICAgLy9oZWFkZXIgcm93XHJcbiAgICAgICAgLy9hZGQgc3BhY2VyIGZvciBtdWx0aSBzZWxlY3QgaWYgbmVlZGVkXHJcbiAgICAgICAgaWYgKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZGVyLWNoZWNrYm94XCIgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jaGVja2JveFwiLCB0eXBlOiBcImNoZWNrYm94XCIsIG9uQ2xpY2s6IHRoaXMudG9nZ2xlU2VsZWN0QWxsLmJpbmQodGhpcykgfSkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkIGJ1dHRvbiBzcGFjZXIgaWYgdGhlcmUgYXJlIGFueSByb3cgYnV0dG9uc1xyXG4gICAgICAgIC8vaWYgdGhlcmUgYXJlIGJ1dHRvbnMgdGhlbiBhZGQgYmxhbmsgaGVhZGVyXHJcbiAgICAgICAgaWYgKHJvd0J1dHRvbnMgJiYgcm93QnV0dG9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZGVyXCIgfSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2FkZCBlYWNoIGNvbHVtblxyXG4gICAgICAgIGZvciAocG9zID0gMDsgcG9zIDwgZmxvd01vZGVsLmNvbHVtbnMubGVuZ3RoOyBwb3MrKykge1xyXG4gICAgICAgICAgICB2YXIgY29sTmFtZSA9IGZsb3dNb2RlbC5jb2x1bW5zW3Bvc10uZGV2ZWxvcGVyTmFtZTtcclxuICAgICAgICAgICAgdmFyIHNvcnRJY29uO1xyXG4gICAgICAgICAgICAvL2lzIHRoaXMgdGhlIHNvcnRlZCBjb2x1bW4gLSBpZiBzbyB0aGVuIHdlIG5lZWQgdG8gc2hvdyB0aGUgc29ydCBkaXJlY3Rpb24gaWNvblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zb3J0SXRlbSAmJiB0aGlzLnNvcnRJdGVtID09IGNvbE5hbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNvcnREaXJlY3Rpb24gPT0gXCJERVNDXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzb3J0SWNvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tYXJyb3ctZG93blwiIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEljb24gPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJnbHlwaGljb24gZ2x5cGhpY29uLWFycm93LXVwXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzb3J0SWNvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29sc1tmbG93TW9kZWwuY29sdW1uc1twb3NdLmRldmVsb3Blck5hbWVdID0gZmxvd01vZGVsLmNvbHVtbnNbcG9zXTtcclxuICAgICAgICAgICAgLy9lYWNoIGhlYWRlciBoYXMgYSBjYXB0aW9uIGFuZCBhIHNvcnQgZGlyZWN0aW9uIGluZGljYXRvclxyXG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInRoXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWhlYWRlclwiLCBcImRhdGEtY29sdW1uLW5hbWVcIjogY29sTmFtZSwgb25DbGljazogdGhpcy5zb3J0LmJpbmQodGhpcykgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgc3R5bGU6IHsgJ2Zsb2F0JzogJ2xlZnQnIH0gfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgbnVsbCwgZmxvd01vZGVsLmNvbHVtbnNbcG9zXS5sYWJlbCkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBzdHlsZTogeyAnZmxvYXQnOiAncmlnaHQnIH0gfSwgc29ydEljb24pKSk7XHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaChoZWFkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2JvZHlcclxuICAgICAgICBmb3IgKHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5vYmplY3REYXRhLmxlbmd0aDsgcG9zKyspIHtcclxuICAgICAgICAgICAgcm93ID0gZmxvd01vZGVsLm9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgcm93SWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShyb3cucHJvcGVydGllcywgdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHZhbHMgPSBbXTtcclxuICAgICAgICAgICAgLy9pZiB0aGUgcm93aWQgaXMgaW4gc2VsZWN0ZWQgdGhlbiBzaG93IGNoZWNrZWRcclxuICAgICAgICAgICAgdmFyIGNoZWNrZWQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBjaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2FkZCBlaXRoZXIgdGhlIGNoZWNrIGJveGVzIG9yIHJvdyBidXR0b25zXHJcbiAgICAgICAgICAgIGlmIChmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgdmFscy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jZWxsLWNoZWNrYm94XCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtY2hlY2tib3hcIiwgdHlwZTogXCJjaGVja2JveFwiLCBjaGVja2VkOiBjaGVja2VkLCBvbkNsaWNrOiB0aGlzLnRvZ2dsZVNlbGVjdEl0ZW0uYmluZCh0aGlzKSB9KSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFscy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jZWxsXCIgfSwgcm93QnV0dG9ucykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAodmFyIGlQb3MgPSAwOyBpUG9zIDwgcm93LnByb3BlcnRpZXMubGVuZ3RoOyBpUG9zKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbERlZiA9IGNvbHNbcm93LnByb3BlcnRpZXNbaVBvc10uZGV2ZWxvcGVyTmFtZV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sRGVmICYmIGNvbERlZi5pc0Rpc3BsYXlWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtY2VsbFwiIH0sIHJvdy5wcm9wZXJ0aWVzW2lQb3NdLmNvbnRlbnRWYWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImV0LXRhYmxlLXJvd1wiO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEl0ZW1zICYmIHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWUgKz0gXCIgZXQtdGFibGUtcm93LXNlbGVjdGVkXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHRpdGxlID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlID0gXCJDbGljayB0byBzZWxlY3QsIERvdWJsZS1DbGljayB0byBvcGVuXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZSA9IFwiQ2xpY2sgdG8gc2VsZWN0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9jcmVhdGUgcm93IG9iamVjdCwgbm90ZSB3ZSBhcmUgYmluZGluZyBzZWxlY3QgdG8gaXRzIGNsaWNrIGFuZCB0aGUgZGJsY2xpY2sgdmFsdWUgKGFuIG91dGNvbWUgaWQpIHRvIGRvdWJsZSBjbGljay4gIEl0IG1heSBiZSBudWxsIGJ1dCB0aGF0cyBmaW5lXHJcbiAgICAgICAgICAgIHZhciByID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInRyXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIFwiZGF0YS1yb3dJZFwiOiByb3dJZCwgXCJkYXRhLW9iamVjdERhdGFcIjogcm93LCBvbkNsaWNrOiB0aGlzLnNlbGVjdFJvdy5iaW5kKHRoaXMsIGNsaWNrKSwgb25Eb3VibGVDbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIGRibENsaWNrKSwgdGl0bGU6IHRpdGxlIH0sIHZhbHMpO1xyXG4gICAgICAgICAgICByb3dzLnB1c2gocik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vY29uc3RydWN0IHRoZSB0YWJsZVxyXG4gICAgICAgIHZhciB0YWJsZSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtZGl2XCIgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInRhYmxlXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlXCIgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0aGVhZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1oZWFkXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidHJcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZGVyLXJvd1wiIH0sIGhlYWRlcnMpKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0Ym9keVwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1ib2R5XCIgfSwgcm93cykpKTtcclxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJldFwiIH0sXHJcbiAgICAgICAgICAgIGxhYmVsLFxyXG4gICAgICAgICAgICB0YWJsZSk7XHJcbiAgICB9O1xyXG4gICAgLy9nZW5lcmljIGhhbmRsZXIgdG8gdHJpZ2dlciBhbiBvdXRjb21lXHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS50cmlnZ2VyT3V0Y29tZSA9IGZ1bmN0aW9uIChvdXRjb21lSWQsIGV2ZW50KSB7XHJcbiAgICAgICAgLy9pZiBubyBvdXRjb21lIGlkIGp1c3QgcXVpdFxyXG4gICAgICAgIGlmICghb3V0Y29tZUlkIHx8IG91dGNvbWVJZC5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJvd0lkO1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciByb3dLZXlGaWVsZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKTtcclxuICAgICAgICB2YXIgbmV3U3RhdGU7XHJcbiAgICAgICAgdmFyIG9iamVjdERhdGFBcnJheSA9IFtdO1xyXG4gICAgICAgIHZhciBvYmplY3REYXRhO1xyXG4gICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnNlbGVjdGVkSXRlbXMpIHtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YSA9IHRoaXMuZ2V0T2JqZWN0RGF0YUJ5S2V5KGZsb3dNb2RlbC5vYmplY3REYXRhLCByb3dLZXlGaWVsZCwgdGhpcy5zZWxlY3RlZEl0ZW1zW2tleV0pO1xyXG4gICAgICAgICAgICAvL2Nsb25lIGRhdGFcclxuICAgICAgICAgICAgb2JqZWN0RGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqZWN0RGF0YSkpO1xyXG4gICAgICAgICAgICBvYmplY3REYXRhLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBvYmplY3REYXRhQXJyYXkucHVzaChvYmplY3REYXRhKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbmV3U3RhdGUgPSB7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGE6IG9iamVjdERhdGFBcnJheVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbWFueXdoby5zdGF0ZS5zZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgbmV3U3RhdGUsIHRoaXMuZmxvd0tleSwgdHJ1ZSk7XHJcbiAgICAgICAgaWYgKG9iamVjdERhdGFBcnJheSkge1xyXG4gICAgICAgICAgICBpZiAob3V0Y29tZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZShvdXRjb21lSWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hbnl3aG8uY29tcG9uZW50Lm9uT3V0Y29tZShvdXRjb21lLCBudWxsLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc29ydERpcmVjdGlvbiAmJiB0aGlzLnNvcnREaXJlY3Rpb24gPT0gXCJBU0NcIikge1xyXG4gICAgICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb24gPSBcIkRFU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydERpcmVjdGlvbiA9IFwiQVNDXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS50b2dnbGVTZWxlY3RBbGwgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQuY3VycmVudFRhcmdldC5jaGVja2VkKSB7XHJcbiAgICAgICAgICAgIC8vY2hlY2sgYWxsXHJcbiAgICAgICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwub2JqZWN0RGF0YS5sZW5ndGg7IHBvcysrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93ID0gZmxvd01vZGVsLm9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHJvdy5wcm9wZXJ0aWVzLCB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICAvL2Egcm93IHdhcyBzZWxlY3RlZCwgc3RvcmUgaXQncyBpZCBhdCBjb21wb25lbnQgbGV2ZWwgYW5kIHJlZHJhd1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuc2VsZWN0Um93ID0gZnVuY3Rpb24gKG91dGNvbWVJZCwgZXZlbnQpIHtcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgLy9vbmx5IG9uZSBjYW4gYmUgc2VsZWN0ZWRcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKSA8IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2goZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudHJpZ2dlck91dGNvbWUob3V0Y29tZUlkLCBldmVudCk7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnRvZ2dsZVNlbGVjdEl0ZW0gPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgcm93SWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpIHx8IGV2ZW50LmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpO1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5wdXNoKHJvd0lkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBpZHggPSB0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy90aGlzLnNvcnRJdGVtID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uLW5hbWUnKTtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgLy9oZWxwZXIgdG8gZ2V0IGEgc3BlY2lmaWMgb2JqZWN0IGRhdGEgaXRlbSBnaXZlbiBhIGZpZWxkPXZhbHVlIGNyaXRlcmlhIFxyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuZ2V0T2JqZWN0RGF0YUJ5S2V5ID0gZnVuY3Rpb24gKG9iamVjdERhdGEsIGZpZWxkTmFtZSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgb2Q7XHJcbiAgICAgICAgdmFyIHZhbDtcclxuICAgICAgICAvL2xvb3Agb3ZlciBkYXRhIGl0ZW1zXHJcbiAgICAgICAgZm9yICh2YXIgcG9zID0gMDsgcG9zIDwgb2JqZWN0RGF0YS5sZW5ndGg7IHBvcysrKSB7XHJcbiAgICAgICAgICAgIG9kID0gb2JqZWN0RGF0YVtwb3NdO1xyXG4gICAgICAgICAgICB2YWwgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShvZC5wcm9wZXJ0aWVzLCBmaWVsZE5hbWUpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKHZhbCA9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBFbmhhbmNlZFRhYmxlO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tYW55d2hvLmNvbXBvbmVudC5yZWdpc3RlcignRW5oYW5jZWRUYWJsZScsIEVuaGFuY2VkVGFibGUpO1xyXG5leHBvcnRzLmRlZmF1bHQgPSBFbmhhbmNlZFRhYmxlO1xyXG5cblxuLyoqKi8gfSksXG4vKiAyICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3Q7XG5cbi8qKiovIH0pLFxuLyogMyAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG4vLyByZW1vdmVkIGJ5IGV4dHJhY3QtdGV4dC13ZWJwYWNrLXBsdWdpblxuXG4vKioqLyB9KVxuLyoqKioqKi8gXSk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIEVuaGFuY2VkVGFibGUuanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCAwM2UxMGEwMDI3Yjc2MTQyNjJiNiIsImV4cG9ydCAqIGZyb20gJy4vRW5oYW5jZWRUYWJsZSc7XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9pbmRleC50c3giLCJcclxuZGVjbGFyZSB2YXIgbWFueXdobzogYW55O1xyXG5cclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgJy4vRW5oYW5jZWRUYWJsZS5jc3MnO1xyXG5cclxuY2xhc3MgRW5oYW5jZWRUYWJsZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT4gXHJcbnsgICBcclxuICAgIGNvbXBvbmVudElkOiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgZmxvd0tleTogc3RyaW5nID1cIlwiOyAgICBcclxuICAgIGF0dHJpYnV0ZXMgOiBhbnkgPSB7fTtcclxuICAgIHNlbGVjdGVkSXRlbXM6IGFueSA9IFtdO1xyXG4gICAgc29ydEl0ZW0gOiBhbnkgPSBudWxsO1xyXG4gICAgc29ydERpcmVjdGlvbiA6IGFueSA9IG51bGw7XHJcblxyXG4gICAgdGV4dCA6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvcHMgOiBhbnkpXHJcblx0e1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuXHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcblx0XHR2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5wcm9wcy5pZCwgICB0aGlzLnByb3BzLmZsb3dLZXkpO1xyXG5cdFx0aWYoZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHR7XHJcblx0XHRcdGZvcih2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0dGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSBcclxuICAgIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKClcclxuICAgIHtcclxuXHJcbiAgICB9XHJcblxyXG5cdGdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lIDogc3RyaW5nKVxyXG5cdHtcclxuXHRcdGlmKHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSlcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuICAgICAgIFxyXG4gICAgcmVuZGVyKClcclxuICAgIHtcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgXHJcbiAgICAgICAgLy9nZXQgYWxsIG91dGNvbWVzIC0gdGhlcmUncyAyIHR5cGVzIC0gcGVyIHJvdyBhbmQgYnVsaywgYnVsayBnbyBhcyBidXR0b25zIG9uIHRvcFxyXG4gICAgICAgIHZhciBvdXRjb21lcyA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZXModGhpcy5jb21wb25lbnRJZCwgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHRvcGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93QnV0dG9ucyA9IFtdO1xyXG5cclxuICAgICAgICB2YXIgZGJsQ2xpY2sgOiBhbnk7XHJcbiAgICAgICAgdmFyIGNsaWNrIDogYW55O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vbG9vcCBvdmVyIG91dGNvbWVzXHJcbiAgICAgICAgZm9yKHZhciBvUG9zID0gMCA7IG9Qb3MgPCBvdXRjb21lcy5sZW5ndGggOyBvUG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG91dGNvbWVzW29Qb3NdO1xyXG4gICAgICAgICAgICBpZihvdXRjb21lLmlzQnVsa0FjdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy90b3AgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaCg8c3BhbiBjbGFzc05hbWU9e2NsYXNzTmFtZX0gb25DbGljaz17dGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpfSB0aXRsZT17b3V0Y29tZS5sYWJlbH0+PC9zcGFuPilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vbXVzdCBiZSBhIHJvdyBidXR0b24sIGl0J3MgYWN0aW9uIGF0dHJpYnV0ZSB3aWxsIHRlbGwgaWYgaXQgc2hvdWxkIGJlIHRoZSBET1VCTEUtQ0xJQ0sgZXZlbnRcclxuICAgICAgICAgICAgICAgIHN3aXRjaChvdXRjb21lLmF0dHJpYnV0ZXNbXCJhY3Rpb25cIl0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNMSUNLXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJET1VCTEUtQ0xJQ0tcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jYW50IGhhdmUgZG91YmxlIGNsaWNrIGZvciBtdWx0aSBzZWxlY3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRibENsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcImxvZy1pblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wYnV0dG9ucy5wdXNoKDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBvbkNsaWNrPXt0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCl9IHRpdGxlPXtvdXRjb21lLmxhYmVsfT48L3NwYW4+KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IG9uQ2xpY2s9e3RoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKX0gdGl0bGU9e291dGNvbWUubGFiZWx9Pjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0J1dHRvbnMucHVzaChidXR0b24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BidXR0b25zLnB1c2goPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IG9uQ2xpY2s9e3RoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKX0gdGl0bGU9e291dGNvbWUubGFiZWx9Pjwvc3Bhbj4pIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGxhYmVsIDogYW55O1xyXG4gICAgICAgIHZhciBsYmwgOiBhbnkgPSBudWxsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vaWYgdGhlIGNvbXBvbmVudCBoYXMgYSBsYWJlbCB0aGVuIHB1dCBpdCBpbiB0aGUgdGl0bGUgYmFyXHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmxhYmVsICYmIGZsb3dNb2RlbC5sYWJlbC5sZW5ndGg+MClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxibCA9IDxzcGFuPntmbG93TW9kZWwubGFiZWx9PC9zcGFuPjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vY3JlYXRlIHRoZSB0aXRsZSBiYXIgb2JqZWN0XHJcbiAgICAgICAgbGFiZWwgPSA8ZGl2IGNsYXNzTmFtZT1cImV0LWNhcHRpb24tZGl2XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJldC1jYXB0aW9uXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtsYmx9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJldC1idXR0b24tYmFyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHt0b3BidXR0b25zfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgXHJcblxyXG5cclxuICAgICAgICB2YXIgaGVhZGVycyA9IFtdO1xyXG4gICAgICAgIHZhciByb3dzID0gW107XHJcbiAgICAgICAgdmFyIGNvbHMgOiBhbnkgPSBbXTtcclxuICAgICAgICB2YXIgY29sRGVmIDogYW55O1xyXG4gICAgICAgIHZhciBwb3MgPSAwO1xyXG4gICAgICAgIHZhciByb3cgOiBhbnk7XHJcbiAgICAgICAgdmFyIHJvd0lkIDogYW55O1xyXG4gICAgICAgIHZhciB2YWxzID0gW107XHJcblxyXG4gICAgICAgIC8vaGVhZGVyIHJvd1xyXG4gICAgICAgIC8vYWRkIHNwYWNlciBmb3IgbXVsdGkgc2VsZWN0IGlmIG5lZWRlZFxyXG4gICAgICAgIGlmKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1oZWFkZXItY2hlY2tib3hcIj48aW5wdXQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2hlY2tib3hcIiB0eXBlPVwiY2hlY2tib3hcIiBvbkNsaWNrPXt0aGlzLnRvZ2dsZVNlbGVjdEFsbC5iaW5kKHRoaXMpfT48L2lucHV0PjwvdGQ+KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkIGJ1dHRvbiBzcGFjZXIgaWYgdGhlcmUgYXJlIGFueSByb3cgYnV0dG9uc1xyXG4gICAgICAgIC8vaWYgdGhlcmUgYXJlIGJ1dHRvbnMgdGhlbiBhZGQgYmxhbmsgaGVhZGVyXHJcbiAgICAgICAgaWYocm93QnV0dG9ucyAmJiByb3dCdXR0b25zLmxlbmd0aCA+IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goPHRkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRlclwiPjwvdGQ+KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vYWRkIGVhY2ggY29sdW1uXHJcbiAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwuY29sdW1ucy5sZW5ndGggOyBwb3MrKylcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIGNvbE5hbWUgPSBmbG93TW9kZWwuY29sdW1uc1twb3NdLmRldmVsb3Blck5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzb3J0SWNvbiA6IGFueTtcclxuXHJcbiAgICAgICAgICAgIC8vaXMgdGhpcyB0aGUgc29ydGVkIGNvbHVtbiAtIGlmIHNvIHRoZW4gd2UgbmVlZCB0byBzaG93IHRoZSBzb3J0IGRpcmVjdGlvbiBpY29uXHJcbiAgICAgICAgICAgIGlmKHRoaXMuc29ydEl0ZW0gJiYgdGhpcy5zb3J0SXRlbT09Y29sTmFtZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zb3J0RGlyZWN0aW9uID09IFwiREVTQ1wiKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy1kb3duXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy11cFwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNvcnRJY29uID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb2xzW2Zsb3dNb2RlbC5jb2x1bW5zW3Bvc10uZGV2ZWxvcGVyTmFtZV0gPSBmbG93TW9kZWwuY29sdW1uc1twb3NdO1xyXG5cclxuICAgICAgICAgICAgLy9lYWNoIGhlYWRlciBoYXMgYSBjYXB0aW9uIGFuZCBhIHNvcnQgZGlyZWN0aW9uIGluZGljYXRvclxyXG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gPHRoIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRlclwiIGRhdGEtY29sdW1uLW5hbWU9e2NvbE5hbWV9IG9uQ2xpY2s9e3RoaXMuc29ydC5iaW5kKHRoaXMpfT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eydmbG9hdCc6ICdsZWZ0J319PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57Zmxvd01vZGVsLmNvbHVtbnNbcG9zXS5sYWJlbH08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eydmbG9hdCc6ICdyaWdodCd9fT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NvcnRJY29ufVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RoPjtcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goaGVhZGVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vYm9keVxyXG4gICAgICAgIGZvciAocG9zID0gMDsgcG9zIDwgZmxvd01vZGVsLm9iamVjdERhdGEubGVuZ3RoIDsgcG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByb3c9Zmxvd01vZGVsLm9iamVjdERhdGFbcG9zXTtcclxuXHJcbiAgICAgICAgICAgIHJvd0lkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkocm93LnByb3BlcnRpZXMsIHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICB2YWxzID0gW107XHJcblxyXG4gICAgICAgICAgICAvL2lmIHRoZSByb3dpZCBpcyBpbiBzZWxlY3RlZCB0aGVuIHNob3cgY2hlY2tlZFxyXG4gICAgICAgICAgICB2YXIgY2hlY2tlZCA6IGFueTtcclxuICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpIDwgMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vYWRkIGVpdGhlciB0aGUgY2hlY2sgYm94ZXMgb3Igcm93IGJ1dHRvbnNcclxuICAgICAgICAgICAgaWYoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhbHMucHVzaCg8dGQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2VsbC1jaGVja2JveFwiPjxpbnB1dCBjbGFzc05hbWU9XCJldC10YWJsZS1jaGVja2JveFwiIHR5cGU9XCJjaGVja2JveFwiIGNoZWNrZWQ9e2NoZWNrZWR9IG9uQ2xpY2s9e3RoaXMudG9nZ2xlU2VsZWN0SXRlbS5iaW5kKHRoaXMpfT48L2lucHV0PjwvdGQ+KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhbHMucHVzaCg8dGQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2VsbFwiPntyb3dCdXR0b25zfTwvdGQ+KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IodmFyIGlQb3MgPSAwIDsgaVBvcyA8IHJvdy5wcm9wZXJ0aWVzLmxlbmd0aCA7IGlQb3MrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29sRGVmID0gY29sc1tyb3cucHJvcGVydGllc1tpUG9zXS5kZXZlbG9wZXJOYW1lXTtcclxuICAgICAgICAgICAgICAgIGlmKCBjb2xEZWYgJiYgY29sRGVmLmlzRGlzcGxheVZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaCg8dGQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2VsbFwiPntyb3cucHJvcGVydGllc1tpUG9zXS5jb250ZW50VmFsdWV9PC90ZD4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJldC10YWJsZS1yb3dcIjtcclxuICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zICYmIHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA+PTApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSArPSBcIiBldC10YWJsZS1yb3ctc2VsZWN0ZWRcIjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHRpdGxlID0gXCJcIjtcclxuICAgICAgICAgICAgaWYoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gdHJ1ZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU9IFwiQ2xpY2sgdG8gc2VsZWN0LCBEb3VibGUtQ2xpY2sgdG8gb3BlblwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGl0bGU9IFwiQ2xpY2sgdG8gc2VsZWN0XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9jcmVhdGUgcm93IG9iamVjdCwgbm90ZSB3ZSBhcmUgYmluZGluZyBzZWxlY3QgdG8gaXRzIGNsaWNrIGFuZCB0aGUgZGJsY2xpY2sgdmFsdWUgKGFuIG91dGNvbWUgaWQpIHRvIGRvdWJsZSBjbGljay4gIEl0IG1heSBiZSBudWxsIGJ1dCB0aGF0cyBmaW5lXHJcbiAgICAgICAgICAgIHZhciByID0gPHRyIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBkYXRhLXJvd0lkPXtyb3dJZH0gZGF0YS1vYmplY3REYXRhPXtyb3d9IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnNlbGVjdFJvdy5iaW5kKHRoaXMsY2xpY2spfSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25Eb3VibGVDbGljaz17dGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsZGJsQ2xpY2spfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT17dGl0bGV9Pnt2YWxzfTwvdHI+O1xyXG5cclxuICAgICAgICAgICAgcm93cy5wdXNoKHIpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vY29uc3RydWN0IHRoZSB0YWJsZVxyXG4gICAgICAgIHZhciB0YWJsZSA6IGFueSA9ICAgPGRpdiBjbGFzc05hbWU9XCJldC10YWJsZS1kaXZcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPVwiZXQtdGFibGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzc05hbWU9XCJldC10YWJsZS1oZWFkZXItcm93XCI+e2hlYWRlcnN9PC90cj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5IGNsYXNzTmFtZT1cImV0LXRhYmxlLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyb3dzfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuXHJcblxyXG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImV0XCI+XHJcbiAgICAgICAgICAgICAgICAgICAge2xhYmVsfVxyXG4gICAgICAgICAgICAgICAgICAgIHt0YWJsZX1cclxuICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgLy9nZW5lcmljIGhhbmRsZXIgdG8gdHJpZ2dlciBhbiBvdXRjb21lXHJcbiAgICB0cmlnZ2VyT3V0Y29tZShvdXRjb21lSWQgOiBhbnksIGV2ZW50IDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIC8vaWYgbm8gb3V0Y29tZSBpZCBqdXN0IHF1aXRcclxuICAgICAgICBpZighb3V0Y29tZUlkIHx8IG91dGNvbWVJZC5sZW5ndGg8MSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJvd0lkIDogYW55O1xyXG4gICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgcm93S2V5RmllbGQgPSB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIik7XHJcblxyXG4gICAgICAgIHZhciBuZXdTdGF0ZSA6IGFueTtcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YUFycmF5ID0gW107XHJcbiAgICAgICAgdmFyIG9iamVjdERhdGEgOiBhbnk7XHJcblxyXG4gICAgICAgIGZvcih2YXIga2V5IGluIHRoaXMuc2VsZWN0ZWRJdGVtcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGE9dGhpcy5nZXRPYmplY3REYXRhQnlLZXkoZmxvd01vZGVsLm9iamVjdERhdGEsIHJvd0tleUZpZWxkLCB0aGlzLnNlbGVjdGVkSXRlbXNba2V5XSk7XHJcbiAgICAgICAgICAgIC8vY2xvbmUgZGF0YVxyXG4gICAgICAgICAgICBvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3REYXRhKSk7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGEuaXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGFBcnJheS5wdXNoKG9iamVjdERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgXHJcbiAgICAgICAgbmV3U3RhdGUgPSB7XHJcblx0XHRcdG9iamVjdERhdGE6IG9iamVjdERhdGFBcnJheVxyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0bWFueXdoby5zdGF0ZS5zZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgbmV3U3RhdGUsIHRoaXMuZmxvd0tleSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGlmKG9iamVjdERhdGFBcnJheSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKG91dGNvbWVJZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBtYW55d2hvLm1vZGVsLmdldE91dGNvbWUob3V0Y29tZUlkLCB0aGlzLmZsb3dLZXkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKG91dGNvbWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFueXdoby5jb21wb25lbnQub25PdXRjb21lKG91dGNvbWUsIG51bGwgLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBzb3J0KGV2ZW50IDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuc29ydEl0ZW0gPSBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2x1bW4tbmFtZScpO1xyXG4gICAgICAgIGlmKHRoaXMuc29ydERpcmVjdGlvbiAmJiB0aGlzLnNvcnREaXJlY3Rpb24gPT0gXCJBU0NcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydERpcmVjdGlvbj1cIkRFU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9uPVwiQVNDXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVTZWxlY3RBbGwoZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgaWYoZXZlbnQuY3VycmVudFRhcmdldC5jaGVja2VkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9jaGVjayBhbGxcclxuICAgICAgICAgICAgY29uc3QgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwub2JqZWN0RGF0YS5sZW5ndGggOyBwb3MrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvdz1mbG93TW9kZWwub2JqZWN0RGF0YVtwb3NdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHJvdy5wcm9wZXJ0aWVzLCB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIikpLmNvbnRlbnRWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5wdXNoKHJvd0lkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy9hIHJvdyB3YXMgc2VsZWN0ZWQsIHN0b3JlIGl0J3MgaWQgYXQgY29tcG9uZW50IGxldmVsIGFuZCByZWRyYXdcclxuICAgIHNlbGVjdFJvdyhvdXRjb21lSWQgOiBhbnksIGV2ZW50IDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICBcclxuICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vb25seSBvbmUgY2FuIGJlIHNlbGVjdGVkXHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2YoZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSkgPCAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2goZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudHJpZ2dlck91dGNvbWUob3V0Y29tZUlkLCBldmVudCk7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZVNlbGVjdEl0ZW0oZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIHJvd0lkPWV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvd0lkJykgfHwgZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvd0lkJyk7XHJcbiAgICAgICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpIDwgMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5wdXNoKHJvd0lkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGlkeCA9IHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnNwbGljZShpZHgsMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAvL2hlbHBlciB0byBnZXQgYSBzcGVjaWZpYyBvYmplY3QgZGF0YSBpdGVtIGdpdmVuIGEgZmllbGQ9dmFsdWUgY3JpdGVyaWEgXHJcbiAgICBnZXRPYmplY3REYXRhQnlLZXkob2JqZWN0RGF0YSA6IGFueSwgZmllbGROYW1lIDogc3RyaW5nLCB2YWx1ZSA6IHN0cmluZylcclxuICAgIHtcclxuICAgICAgICB2YXIgb2QgOiBhbnk7XHJcbiAgICAgICAgdmFyIHZhbCA6IGFueTtcclxuICAgICAgICAvL2xvb3Agb3ZlciBkYXRhIGl0ZW1zXHJcbiAgICAgICAgZm9yKHZhciBwb3MgPSAwIDsgcG9zIDwgb2JqZWN0RGF0YS5sZW5ndGg7IHBvcysrKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgb2QgPSBvYmplY3REYXRhW3Bvc107XHJcbiAgICAgICAgICAgIHZhbCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KG9kLnByb3BlcnRpZXMsIGZpZWxkTmFtZSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICBpZih2YWw9PXZhbHVlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIFxyXG59XHJcblxyXG5tYW55d2hvLmNvbXBvbmVudC5yZWdpc3RlcignRW5oYW5jZWRUYWJsZScsIEVuaGFuY2VkVGFibGUpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgRW5oYW5jZWRUYWJsZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvRW5oYW5jZWRUYWJsZS50c3giLCJtb2R1bGUuZXhwb3J0cyA9IFJlYWN0O1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiUmVhY3RcIlxuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9