!function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(1))},function(e,t,o){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=o(2);o(3);var r=function(e){function t(t){var o=e.call(this,t)||this;o.componentId="",o.flowKey="",o.attributes={},o.selectedItems=[],o.sortItem=null,o.sortDirection=null,o.text="",o.componentId=t.id,o.flowKey=t.flowKey;var n=manywho.model.getComponent(o.props.id,o.props.flowKey);if(n.attributes)for(var a in n.attributes)o.attributes[a]=n.attributes[a];return o}return n(t,e),t.prototype.componentDidMount=function(){this.forceUpdate()},t.prototype.componentDidUpdate=function(){},t.prototype.getAttribute=function(e){return this.attributes[e]?this.attributes[e]:null},t.prototype.render=function(){for(var e,t,o=manywho.model.getComponent(this.componentId,this.flowKey),n=(manywho.state.getComponent(this.componentId,this.flowKey),manywho.model.getOutcomes(this.componentId,this.flowKey)),r=[],l=[],s=0;s<n.length;s++){var i=n[s];if(i.isBulkAction){var c=i.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button";r.push(a.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label}))}else switch(i.attributes.action){case"CLICK":t=i.id;break;case"DOUBLE-CLICK":if(0==o.isMultiSelect)e=i.id;else{var c=i.attributes.icon||"log-in",u="glyphicon glyphicon-"+c+" et-button-bar-button";r.push(a.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label}))}break;default:if(0==o.isMultiSelect){var c=i.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button",m=a.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label});l.push(m)}else{var c=i.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button";r.push(a.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label}))}}}var h,p=null;o.label&&o.label.length>0&&(p=a.createElement("span",null,o.label)),h=a.createElement("div",{className:"et-caption-div"},a.createElement("div",{className:"et-caption"},p),a.createElement("div",{className:"et-button-bar"},r));var d,b,f,y=[],g=[],v=[],w=0,E=[];for(o.isMultiSelect&&y.push(a.createElement("td",{className:"et-table-header-checkbox"},a.createElement("input",{className:"et-table-checkbox",type:"checkbox",onClick:this.toggleSelectAll.bind(this)}))),l&&l.length>0&&y.push(a.createElement("td",{className:"et-table-header"})),w=0;w<o.columns.length;w++){var I,O=o.columns[w].developerName;I=this.sortItem&&this.sortItem==O?"DESC"==this.sortDirection?a.createElement("span",{className:"glyphicon glyphicon-arrow-down"}):a.createElement("span",{className:"glyphicon glyphicon-arrow-up"}):null,v[o.columns[w].developerName]=o.columns[w];var N=a.createElement("th",{className:"et-table-header","data-column-name":O,onClick:this.sort.bind(this)},a.createElement("div",null,a.createElement("div",{style:{float:"left"}},a.createElement("span",null,o.columns[w].label)),a.createElement("div",{style:{float:"right"}},I)));y.push(N)}if(o.objectData)for(w=0;w<o.objectData.length;w++){b=o.objectData[w],f=manywho.utils.getObjectDataProperty(b.properties,this.getAttribute("Row Key")).contentValue,E=[];var C;C=!(this.selectedItems.indexOf(f)<0),o.isMultiSelect?E.push(a.createElement("td",{className:"et-table-cell-checkbox"},a.createElement("input",{className:"et-table-checkbox",type:"checkbox",checked:C,onClick:this.toggleSelectItem.bind(this)}))):l.length>0&&E.push(a.createElement("td",{className:"et-table-cell"},l));for(var D=0;D<b.properties.length;D++)if((d=v[b.properties[D].developerName])&&d.isDisplayValue)if(""==d.componentType)E.push(a.createElement("td",{className:"et-table-cell"},b.properties[D].contentValue));else{var k=a.createElement(manywho.component.getByName(d.componentType),b.properties[D],null);E.push(a.createElement("td",{className:"et-table-cell"},k))}var u="et-table-row";this.selectedItems&&this.selectedItems.indexOf(f)>=0&&(u+=" et-table-row-selected");var j="";j=1==o.isMultiSelect?"Click to select, Double-Click to open":"Click to select";var x=a.createElement("tr",{className:u,"data-rowId":f,"data-objectData":b,onClick:this.selectRow.bind(this,t),onDoubleClick:this.triggerOutcome.bind(this,e),title:j},E);g.push(x)}else{var x=a.createElement("tr",{className:u},a.createElement("td",{colSpan:Object.keys(v).length},"No Work Items"));g.push(x)}var K=a.createElement("div",{className:"et-table-div"},a.createElement("table",{className:"et-table"},a.createElement("thead",{className:"et-table-head"},a.createElement("tr",{className:"et-table-header-row"},y)),a.createElement("tbody",{className:"et-table-body"},g)));return a.createElement("div",{className:"et"},h,K)},t.prototype.triggerOutcome=function(e,t){if(e&&!(e.length<1)){var o,n,a=manywho.model.getComponent(this.componentId,this.flowKey),r=this.getAttribute("Row Key"),l=[];for(var s in this.selectedItems)n=this.getObjectDataByKey(a.objectData,r,this.selectedItems[s]),n=JSON.parse(JSON.stringify(n)),n.isSelected=!0,l.push(n);if(o={objectData:l},manywho.state.setComponent(this.componentId,o,this.flowKey,!0),l&&e){var i=manywho.model.getOutcome(e,this.flowKey);i&&manywho.component.onOutcome(i,l,this.flowKey)}this.forceUpdate()}},t.prototype.sort=function(e){this.sortItem=e.currentTarget.getAttribute("data-column-name"),this.sortDirection&&"ASC"==this.sortDirection?this.sortDirection="DESC":this.sortDirection="ASC",this.forceUpdate()},t.prototype.toggleSelectAll=function(e){if(e.currentTarget.checked)for(var t=manywho.model.getComponent(this.componentId,this.flowKey),o=0;o<t.objectData.length;o++){var n=t.objectData[o],a=manywho.utils.getObjectDataProperty(n.properties,this.getAttribute("Row Key")).contentValue;this.selectedItems.indexOf(a)<0&&this.selectedItems.push(a)}else this.selectedItems=[];return this.forceUpdate(),!1},t.prototype.selectRow=function(e,t){0==manywho.model.getComponent(this.componentId,this.flowKey).isMultiSelect&&(this.selectedItems=[]),this.selectedItems.indexOf(t.currentTarget.getAttribute("data-rowId"))<0&&this.selectedItems.push(t.currentTarget.getAttribute("data-rowId")),this.triggerOutcome(e,t),this.forceUpdate()},t.prototype.toggleSelectItem=function(e){var t=e.currentTarget.getAttribute("data-rowId")||e.currentTarget.parentElement.parentElement.getAttribute("data-rowId");if(this.selectedItems.indexOf(t)<0)this.selectedItems.push(t);else{var o=this.selectedItems.indexOf(t);this.selectedItems.splice(o,1)}e.stopPropagation(),this.forceUpdate()},t.prototype.getObjectDataByKey=function(e,t,o){for(var n,a=0;a<e.length;a++)if(n=e[a],manywho.utils.getObjectDataProperty(n.properties,t).contentValue==o)return n;return null},t}(a.Component);manywho.component.register("EnhancedTable",r),t.default=r},function(e,t){e.exports=React},function(e,t){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vRW5oYW5jZWRUYWJsZS5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMzkzNmNlYTI2OGViOGExZDg3MzciLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzeCIsIndlYnBhY2s6Ly8vLi9zcmMvRW5oYW5jZWRUYWJsZS50c3giLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUmVhY3RcIiJdLCJuYW1lcyI6WyJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidmFsdWUiLCJfX2V4dGVuZHMiLCJ0aGlzIiwiZXh0ZW5kU3RhdGljcyIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJiIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIlJlYWN0IiwiRW5oYW5jZWRUYWJsZSIsIl9zdXBlciIsInByb3BzIiwiX3RoaXMiLCJjb21wb25lbnRJZCIsImZsb3dLZXkiLCJhdHRyaWJ1dGVzIiwic2VsZWN0ZWRJdGVtcyIsInNvcnRJdGVtIiwic29ydERpcmVjdGlvbiIsInRleHQiLCJpZCIsImZsb3dNb2RlbCIsIm1hbnl3aG8iLCJtb2RlbCIsImdldENvbXBvbmVudCIsImtleSIsImNvbXBvbmVudERpZE1vdW50IiwiZm9yY2VVcGRhdGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGVOYW1lIiwicmVuZGVyIiwiZGJsQ2xpY2siLCJjbGljayIsIm91dGNvbWVzIiwic3RhdGUiLCJnZXRPdXRjb21lcyIsInRvcGJ1dHRvbnMiLCJyb3dCdXR0b25zIiwib1BvcyIsImxlbmd0aCIsIm91dGNvbWUiLCJpc0J1bGtBY3Rpb24iLCJpY29uIiwiY2xhc3NOYW1lIiwicHVzaCIsImNyZWF0ZUVsZW1lbnQiLCJvbkNsaWNrIiwidHJpZ2dlck91dGNvbWUiLCJiaW5kIiwidGl0bGUiLCJsYWJlbCIsImlzTXVsdGlTZWxlY3QiLCJidXR0b24iLCJsYmwiLCJjb2xEZWYiLCJyb3ciLCJyb3dJZCIsImhlYWRlcnMiLCJyb3dzIiwiY29scyIsInBvcyIsInZhbHMiLCJ0eXBlIiwidG9nZ2xlU2VsZWN0QWxsIiwiY29sdW1ucyIsInNvcnRJY29uIiwiY29sTmFtZSIsImRldmVsb3Blck5hbWUiLCJoZWFkZXIiLCJkYXRhLWNvbHVtbi1uYW1lIiwic29ydCIsInN0eWxlIiwiZmxvYXQiLCJvYmplY3REYXRhIiwidXRpbHMiLCJnZXRPYmplY3REYXRhUHJvcGVydHkiLCJwcm9wZXJ0aWVzIiwiY29udGVudFZhbHVlIiwiY2hlY2tlZCIsImluZGV4T2YiLCJ0b2dnbGVTZWxlY3RJdGVtIiwiaVBvcyIsImlzRGlzcGxheVZhbHVlIiwiY29tcG9uZW50VHlwZSIsImNvbXBvbmVudCIsImdldEJ5TmFtZSIsInIiLCJkYXRhLXJvd0lkIiwiZGF0YS1vYmplY3REYXRhIiwic2VsZWN0Um93Iiwib25Eb3VibGVDbGljayIsImNvbFNwYW4iLCJrZXlzIiwidGFibGUiLCJvdXRjb21lSWQiLCJldmVudCIsIm5ld1N0YXRlIiwicm93S2V5RmllbGQiLCJvYmplY3REYXRhQXJyYXkiLCJnZXRPYmplY3REYXRhQnlLZXkiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJpc1NlbGVjdGVkIiwic2V0Q29tcG9uZW50IiwiZ2V0T3V0Y29tZSIsIm9uT3V0Y29tZSIsImN1cnJlbnRUYXJnZXQiLCJwYXJlbnRFbGVtZW50IiwiaWR4Iiwic3BsaWNlIiwic3RvcFByb3BhZ2F0aW9uIiwiZmllbGRO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LGNBQWMrRixPQUFPRCxFQUFJLEdBR2xDZCxFQUFNZ0Isa0JBQ05qSCxLQUFLNEIsZUFLVGxCLEVBQUFoQixVQUFBMkcsbUJBQUEsU0FBbUIxQixFQUFrQnVDLEVBQW9CcEgsR0FLckQsSUFBSSxHQUhBcUgsR0FHSXJELEVBQU0sRUFBSUEsRUFBTWEsRUFBV2xDLE9BQVFxQixJQUl2QyxHQUZBcUQsRUFBS3hDLEVBQVdiLEdBQ1Z2QyxRQUFRcUQsTUFBTUMsc0JBQXNCc0MsRUFBR3JDLFdBQVlvQyxHQUFXbkMsY0FDNURqRixFQUVKLE1BQU9xSCxFQUdmLE9BQU8sT0FLZnpHLEdBemM0QkQsRUFBTTJHLFVBMmNsQzdGLFNBQVErRCxVQUFVK0IsU0FBUyxnQkFBaUIzRyxHQUU1Q3BDLEVBQUFnSixRQUFlNUcsR0h0RFQsU0FBVW5DLEVBQVFELEdJN1p4QkMsRUFBQUQsUUFBQW1DLE9KbWFNLFNBQVVsQyxFQUFRRCIsImZpbGUiOiJFbmhhbmNlZFRhYmxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKi8gKGZ1bmN0aW9uKG1vZHVsZXMpIHsgLy8gd2VicGFja0Jvb3RzdHJhcFxuLyoqKioqKi8gXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuLyoqKioqKi8gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovIFx0XHR9XG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRpOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGw6IGZhbHNlLFxuLyoqKioqKi8gXHRcdFx0ZXhwb3J0czoge31cbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbi8qKioqKiovIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4vKioqKioqLyBcdH1cbi8qKioqKiovXG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbi8qKioqKiovIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4vKioqKioqLyBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuLyoqKioqKi8gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuLyoqKioqKi8gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuLyoqKioqKi8gXHRcdFx0XHRnZXQ6IGdldHRlclxuLyoqKioqKi8gXHRcdFx0fSk7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4vKioqKioqLyBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4vKioqKioqLyBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbi8qKioqKiovIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4vKioqKioqLyBcdFx0cmV0dXJuIGdldHRlcjtcbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoW1xuLyogMCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxyXG5mdW5jdGlvbiBfX2V4cG9ydChtKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5fX2V4cG9ydChfX3dlYnBhY2tfcmVxdWlyZV9fKDEpKTtcclxuXG5cbi8qKiovIH0pLFxuLyogMSAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgUmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIpO1xyXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDMpO1xyXG52YXIgRW5oYW5jZWRUYWJsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhFbmhhbmNlZFRhYmxlLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRW5oYW5jZWRUYWJsZShwcm9wcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmNvbXBvbmVudElkID0gXCJcIjtcclxuICAgICAgICBfdGhpcy5mbG93S2V5ID0gXCJcIjtcclxuICAgICAgICBfdGhpcy5hdHRyaWJ1dGVzID0ge307XHJcbiAgICAgICAgX3RoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG4gICAgICAgIF90aGlzLnNvcnRJdGVtID0gbnVsbDtcclxuICAgICAgICBfdGhpcy5zb3J0RGlyZWN0aW9uID0gbnVsbDtcclxuICAgICAgICBfdGhpcy50ZXh0ID0gXCJcIjtcclxuICAgICAgICBfdGhpcy5jb21wb25lbnRJZCA9IHByb3BzLmlkO1xyXG4gICAgICAgIF90aGlzLmZsb3dLZXkgPSBwcm9wcy5mbG93S2V5O1xyXG4gICAgICAgIC8vcHVzaCBhdHRyaWJ1dGVzIGludG8ga2V5ZWQgbWFwIFxyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudChfdGhpcy5wcm9wcy5pZCwgX3RoaXMucHJvcHMuZmxvd0tleSk7XHJcbiAgICAgICAgaWYgKGZsb3dNb2RlbC5hdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBmbG93TW9kZWwuYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuYXR0cmlidXRlc1trZXldID0gZmxvd01vZGVsLmF0dHJpYnV0ZXNba2V5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuY29tcG9uZW50RGlkVXBkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChhdHRyaWJ1dGVOYW1lKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAvL2dldCBhbGwgb3V0Y29tZXMgLSB0aGVyZSdzIDIgdHlwZXMgLSBwZXIgcm93IGFuZCBidWxrLCBidWxrIGdvIGFzIGJ1dHRvbnMgb24gdG9wXHJcbiAgICAgICAgdmFyIG91dGNvbWVzID0gbWFueXdoby5tb2RlbC5nZXRPdXRjb21lcyh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciB0b3BidXR0b25zID0gW107XHJcbiAgICAgICAgdmFyIHJvd0J1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgZGJsQ2xpY2s7XHJcbiAgICAgICAgdmFyIGNsaWNrO1xyXG4gICAgICAgIC8vbG9vcCBvdmVyIG91dGNvbWVzXHJcbiAgICAgICAgZm9yICh2YXIgb1BvcyA9IDA7IG9Qb3MgPCBvdXRjb21lcy5sZW5ndGg7IG9Qb3MrKykge1xyXG4gICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG91dGNvbWVzW29Qb3NdO1xyXG4gICAgICAgICAgICBpZiAob3V0Y29tZS5pc0J1bGtBY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIC8vdG9wIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICB0b3BidXR0b25zLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgb25DbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpLCB0aXRsZTogb3V0Y29tZS5sYWJlbCB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL211c3QgYmUgYSByb3cgYnV0dG9uLCBpdCdzIGFjdGlvbiBhdHRyaWJ1dGUgd2lsbCB0ZWxsIGlmIGl0IHNob3VsZCBiZSB0aGUgRE9VQkxFLUNMSUNLIGV2ZW50XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG91dGNvbWUuYXR0cmlidXRlc1tcImFjdGlvblwiXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJDTElDS1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGljayA9IG91dGNvbWUuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJET1VCTEUtQ0xJQ0tcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jYW50IGhhdmUgZG91YmxlIGNsaWNrIGZvciBtdWx0aSBzZWxlY3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYmxDbGljayA9IG91dGNvbWUuaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJsb2ctaW5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lLCBvbkNsaWNrOiB0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCksIHRpdGxlOiBvdXRjb21lLmxhYmVsIH0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcIndyZW5jaFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIG9uQ2xpY2s6IHRoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKSwgdGl0bGU6IG91dGNvbWUubGFiZWwgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dCdXR0b25zLnB1c2goYnV0dG9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcIndyZW5jaFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wYnV0dG9ucy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIG9uQ2xpY2s6IHRoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKSwgdGl0bGU6IG91dGNvbWUubGFiZWwgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBsYWJlbDtcclxuICAgICAgICB2YXIgbGJsID0gbnVsbDtcclxuICAgICAgICAvL2lmIHRoZSBjb21wb25lbnQgaGFzIGEgbGFiZWwgdGhlbiBwdXQgaXQgaW4gdGhlIHRpdGxlIGJhclxyXG4gICAgICAgIGlmIChmbG93TW9kZWwubGFiZWwgJiYgZmxvd01vZGVsLmxhYmVsLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgbGJsID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgbnVsbCwgZmxvd01vZGVsLmxhYmVsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9jcmVhdGUgdGhlIHRpdGxlIGJhciBvYmplY3RcclxuICAgICAgICBsYWJlbCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXQtY2FwdGlvbi1kaXZcIiB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LWNhcHRpb25cIiB9LCBsYmwpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LWJ1dHRvbi1iYXJcIiB9LCB0b3BidXR0b25zKSk7XHJcbiAgICAgICAgdmFyIGhlYWRlcnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93cyA9IFtdO1xyXG4gICAgICAgIHZhciBjb2xzID0gW107XHJcbiAgICAgICAgdmFyIGNvbERlZjtcclxuICAgICAgICB2YXIgcG9zID0gMDtcclxuICAgICAgICB2YXIgcm93O1xyXG4gICAgICAgIHZhciByb3dJZDtcclxuICAgICAgICB2YXIgdmFscyA9IFtdO1xyXG4gICAgICAgIC8vaGVhZGVyIHJvd1xyXG4gICAgICAgIC8vYWRkIHNwYWNlciBmb3IgbXVsdGkgc2VsZWN0IGlmIG5lZWRlZFxyXG4gICAgICAgIGlmIChmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInRkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWhlYWRlci1jaGVja2JveFwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtY2hlY2tib3hcIiwgdHlwZTogXCJjaGVja2JveFwiLCBvbkNsaWNrOiB0aGlzLnRvZ2dsZVNlbGVjdEFsbC5iaW5kKHRoaXMpIH0pKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGFkZCBidXR0b24gc3BhY2VyIGlmIHRoZXJlIGFyZSBhbnkgcm93IGJ1dHRvbnNcclxuICAgICAgICAvL2lmIHRoZXJlIGFyZSBidXR0b25zIHRoZW4gYWRkIGJsYW5rIGhlYWRlclxyXG4gICAgICAgIGlmIChyb3dCdXR0b25zICYmIHJvd0J1dHRvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInRkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWhlYWRlclwiIH0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9hZGQgZWFjaCBjb2x1bW5cclxuICAgICAgICBmb3IgKHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5jb2x1bW5zLmxlbmd0aDsgcG9zKyspIHtcclxuICAgICAgICAgICAgdmFyIGNvbE5hbWUgPSBmbG93TW9kZWwuY29sdW1uc1twb3NdLmRldmVsb3Blck5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzb3J0SWNvbjtcclxuICAgICAgICAgICAgLy9pcyB0aGlzIHRoZSBzb3J0ZWQgY29sdW1uIC0gaWYgc28gdGhlbiB3ZSBuZWVkIHRvIHNob3cgdGhlIHNvcnQgZGlyZWN0aW9uIGljb25cclxuICAgICAgICAgICAgaWYgKHRoaXMuc29ydEl0ZW0gJiYgdGhpcy5zb3J0SXRlbSA9PSBjb2xOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zb3J0RGlyZWN0aW9uID09IFwiREVTQ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEljb24gPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJnbHlwaGljb24gZ2x5cGhpY29uLWFycm93LWRvd25cIiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy11cFwiIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ydEljb24gPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbHNbZmxvd01vZGVsLmNvbHVtbnNbcG9zXS5kZXZlbG9wZXJOYW1lXSA9IGZsb3dNb2RlbC5jb2x1bW5zW3Bvc107XHJcbiAgICAgICAgICAgIC8vZWFjaCBoZWFkZXIgaGFzIGEgY2FwdGlvbiBhbmQgYSBzb3J0IGRpcmVjdGlvbiBpbmRpY2F0b3JcclxuICAgICAgICAgICAgdmFyIGhlYWRlciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0aFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1oZWFkZXJcIiwgXCJkYXRhLWNvbHVtbi1uYW1lXCI6IGNvbE5hbWUsIG9uQ2xpY2s6IHRoaXMuc29ydC5iaW5kKHRoaXMpIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IHN0eWxlOiB7ICdmbG9hdCc6ICdsZWZ0JyB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIG51bGwsIGZsb3dNb2RlbC5jb2x1bW5zW3Bvc10ubGFiZWwpKSxcclxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgc3R5bGU6IHsgJ2Zsb2F0JzogJ3JpZ2h0JyB9IH0sIHNvcnRJY29uKSkpO1xyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goaGVhZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9ib2R5XHJcbiAgICAgICAgaWYgKGZsb3dNb2RlbC5vYmplY3REYXRhKSB7XHJcbiAgICAgICAgICAgIGZvciAocG9zID0gMDsgcG9zIDwgZmxvd01vZGVsLm9iamVjdERhdGEubGVuZ3RoOyBwb3MrKykge1xyXG4gICAgICAgICAgICAgICAgcm93ID0gZmxvd01vZGVsLm9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgICAgIHJvd0lkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkocm93LnByb3BlcnRpZXMsIHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdmFscyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgLy9pZiB0aGUgcm93aWQgaXMgaW4gc2VsZWN0ZWQgdGhlbiBzaG93IGNoZWNrZWRcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja2VkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vYWRkIGVpdGhlciB0aGUgY2hlY2sgYm94ZXMgb3Igcm93IGJ1dHRvbnNcclxuICAgICAgICAgICAgICAgIGlmIChmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtY2VsbC1jaGVja2JveFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jaGVja2JveFwiLCB0eXBlOiBcImNoZWNrYm94XCIsIGNoZWNrZWQ6IGNoZWNrZWQsIG9uQ2xpY2s6IHRoaXMudG9nZ2xlU2VsZWN0SXRlbS5iaW5kKHRoaXMpIH0pKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocm93QnV0dG9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtY2VsbFwiIH0sIHJvd0J1dHRvbnMpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpUG9zID0gMDsgaVBvcyA8IHJvdy5wcm9wZXJ0aWVzLmxlbmd0aDsgaVBvcysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sRGVmID0gY29sc1tyb3cucHJvcGVydGllc1tpUG9zXS5kZXZlbG9wZXJOYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29sRGVmICYmIGNvbERlZi5pc0Rpc3BsYXlWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sRGVmLmNvbXBvbmVudFR5cGUgPT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFscy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jZWxsXCIgfSwgcm93LnByb3BlcnRpZXNbaVBvc10uY29udGVudFZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tcG9uZW50ID0gUmVhY3QuY3JlYXRlRWxlbWVudChtYW55d2hvLmNvbXBvbmVudC5nZXRCeU5hbWUoY29sRGVmLmNvbXBvbmVudFR5cGUpLCByb3cucHJvcGVydGllc1tpUG9zXSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInRkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWNlbGxcIiB9LCBjb21wb25lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImV0LXRhYmxlLXJvd1wiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcyAmJiB0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSArPSBcIiBldC10YWJsZS1yb3ctc2VsZWN0ZWRcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlID0gXCJDbGljayB0byBzZWxlY3QsIERvdWJsZS1DbGljayB0byBvcGVuXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZSA9IFwiQ2xpY2sgdG8gc2VsZWN0XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL2NyZWF0ZSByb3cgb2JqZWN0LCBub3RlIHdlIGFyZSBiaW5kaW5nIHNlbGVjdCB0byBpdHMgY2xpY2sgYW5kIHRoZSBkYmxjbGljayB2YWx1ZSAoYW4gb3V0Y29tZSBpZCkgdG8gZG91YmxlIGNsaWNrLiAgSXQgbWF5IGJlIG51bGwgYnV0IHRoYXRzIGZpbmVcclxuICAgICAgICAgICAgICAgIHZhciByID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInRyXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIFwiZGF0YS1yb3dJZFwiOiByb3dJZCwgXCJkYXRhLW9iamVjdERhdGFcIjogcm93LCBvbkNsaWNrOiB0aGlzLnNlbGVjdFJvdy5iaW5kKHRoaXMsIGNsaWNrKSwgb25Eb3VibGVDbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIGRibENsaWNrKSwgdGl0bGU6IHRpdGxlIH0sIHZhbHMpO1xyXG4gICAgICAgICAgICAgICAgcm93cy5wdXNoKHIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0clwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjb2xTcGFuOiBPYmplY3Qua2V5cyhjb2xzKS5sZW5ndGggfSwgXCJObyBXb3JrIEl0ZW1zXCIpKTtcclxuICAgICAgICAgICAgcm93cy5wdXNoKHIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2NvbnN0cnVjdCB0aGUgdGFibGVcclxuICAgICAgICB2YXIgdGFibGUgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWRpdlwiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZVwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGhlYWRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInRyXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWhlYWRlci1yb3dcIiB9LCBoZWFkZXJzKSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGJvZHlcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtYm9keVwiIH0sIHJvd3MpKSk7XHJcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXRcIiB9LFxyXG4gICAgICAgICAgICBsYWJlbCxcclxuICAgICAgICAgICAgdGFibGUpO1xyXG4gICAgfTtcclxuICAgIC8vZ2VuZXJpYyBoYW5kbGVyIHRvIHRyaWdnZXIgYW4gb3V0Y29tZVxyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUudHJpZ2dlck91dGNvbWUgPSBmdW5jdGlvbiAob3V0Y29tZUlkLCBldmVudCkge1xyXG4gICAgICAgIC8vaWYgbm8gb3V0Y29tZSBpZCBqdXN0IHF1aXRcclxuICAgICAgICBpZiAoIW91dGNvbWVJZCB8fCBvdXRjb21lSWQubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByb3dJZDtcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgcm93S2V5RmllbGQgPSB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIik7XHJcbiAgICAgICAgdmFyIG5ld1N0YXRlO1xyXG4gICAgICAgIHZhciBvYmplY3REYXRhQXJyYXkgPSBbXTtcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zZWxlY3RlZEl0ZW1zKSB7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGEgPSB0aGlzLmdldE9iamVjdERhdGFCeUtleShmbG93TW9kZWwub2JqZWN0RGF0YSwgcm93S2V5RmllbGQsIHRoaXMuc2VsZWN0ZWRJdGVtc1trZXldKTtcclxuICAgICAgICAgICAgLy9jbG9uZSBkYXRhXHJcbiAgICAgICAgICAgIG9iamVjdERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iamVjdERhdGEpKTtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YS5pc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YUFycmF5LnB1c2gob2JqZWN0RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld1N0YXRlID0ge1xyXG4gICAgICAgICAgICBvYmplY3REYXRhOiBvYmplY3REYXRhQXJyYXlcclxuICAgICAgICB9O1xyXG4gICAgICAgIG1hbnl3aG8uc3RhdGUuc2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIG5ld1N0YXRlLCB0aGlzLmZsb3dLZXksIHRydWUpO1xyXG4gICAgICAgIGlmIChvYmplY3REYXRhQXJyYXkpIHtcclxuICAgICAgICAgICAgaWYgKG91dGNvbWVJZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBtYW55d2hvLm1vZGVsLmdldE91dGNvbWUob3V0Y29tZUlkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG91dGNvbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYW55d2hvLmNvbXBvbmVudC5vbk91dGNvbWUob3V0Y29tZSwgb2JqZWN0RGF0YUFycmF5LCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc29ydERpcmVjdGlvbiAmJiB0aGlzLnNvcnREaXJlY3Rpb24gPT0gXCJBU0NcIikge1xyXG4gICAgICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb24gPSBcIkRFU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydERpcmVjdGlvbiA9IFwiQVNDXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS50b2dnbGVTZWxlY3RBbGwgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBpZiAoZXZlbnQuY3VycmVudFRhcmdldC5jaGVja2VkKSB7XHJcbiAgICAgICAgICAgIC8vY2hlY2sgYWxsXHJcbiAgICAgICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwub2JqZWN0RGF0YS5sZW5ndGg7IHBvcysrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93ID0gZmxvd01vZGVsLm9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgICAgIHZhciByb3dJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHJvdy5wcm9wZXJ0aWVzLCB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICAvL2Egcm93IHdhcyBzZWxlY3RlZCwgc3RvcmUgaXQncyBpZCBhdCBjb21wb25lbnQgbGV2ZWwgYW5kIHJlZHJhd1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuc2VsZWN0Um93ID0gZnVuY3Rpb24gKG91dGNvbWVJZCwgZXZlbnQpIHtcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgLy9vbmx5IG9uZSBjYW4gYmUgc2VsZWN0ZWRcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKSA8IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2goZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudHJpZ2dlck91dGNvbWUob3V0Y29tZUlkLCBldmVudCk7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnRvZ2dsZVNlbGVjdEl0ZW0gPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgcm93SWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpIHx8IGV2ZW50LmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpO1xyXG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5wdXNoKHJvd0lkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBpZHggPSB0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcy5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy90aGlzLnNvcnRJdGVtID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uLW5hbWUnKTtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgLy9oZWxwZXIgdG8gZ2V0IGEgc3BlY2lmaWMgb2JqZWN0IGRhdGEgaXRlbSBnaXZlbiBhIGZpZWxkPXZhbHVlIGNyaXRlcmlhIFxyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuZ2V0T2JqZWN0RGF0YUJ5S2V5ID0gZnVuY3Rpb24gKG9iamVjdERhdGEsIGZpZWxkTmFtZSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgb2Q7XHJcbiAgICAgICAgdmFyIHZhbDtcclxuICAgICAgICAvL2xvb3Agb3ZlciBkYXRhIGl0ZW1zXHJcbiAgICAgICAgZm9yICh2YXIgcG9zID0gMDsgcG9zIDwgb2JqZWN0RGF0YS5sZW5ndGg7IHBvcysrKSB7XHJcbiAgICAgICAgICAgIG9kID0gb2JqZWN0RGF0YVtwb3NdO1xyXG4gICAgICAgICAgICB2YWwgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShvZC5wcm9wZXJ0aWVzLCBmaWVsZE5hbWUpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKHZhbCA9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBFbmhhbmNlZFRhYmxlO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tYW55d2hvLmNvbXBvbmVudC5yZWdpc3RlcignRW5oYW5jZWRUYWJsZScsIEVuaGFuY2VkVGFibGUpO1xyXG5leHBvcnRzLmRlZmF1bHQgPSBFbmhhbmNlZFRhYmxlO1xyXG5cblxuLyoqKi8gfSksXG4vKiAyICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3Q7XG5cbi8qKiovIH0pLFxuLyogMyAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG4vLyByZW1vdmVkIGJ5IGV4dHJhY3QtdGV4dC13ZWJwYWNrLXBsdWdpblxuXG4vKioqLyB9KVxuLyoqKioqKi8gXSk7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIEVuaGFuY2VkVGFibGUuanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCAzOTM2Y2VhMjY4ZWI4YTFkODczNyIsImV4cG9ydCAqIGZyb20gJy4vRW5oYW5jZWRUYWJsZSc7XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9pbmRleC50c3giLCJcclxuZGVjbGFyZSB2YXIgbWFueXdobzogYW55O1xyXG5cclxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgJy4vRW5oYW5jZWRUYWJsZS5jc3MnO1xyXG5cclxuY2xhc3MgRW5oYW5jZWRUYWJsZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT4gXHJcbnsgICBcclxuICAgIGNvbXBvbmVudElkOiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgZmxvd0tleTogc3RyaW5nID1cIlwiOyAgICBcclxuICAgIGF0dHJpYnV0ZXMgOiBhbnkgPSB7fTtcclxuICAgIHNlbGVjdGVkSXRlbXM6IGFueSA9IFtdO1xyXG4gICAgc29ydEl0ZW0gOiBhbnkgPSBudWxsO1xyXG4gICAgc29ydERpcmVjdGlvbiA6IGFueSA9IG51bGw7XHJcblxyXG4gICAgdGV4dCA6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvcHMgOiBhbnkpXHJcblx0e1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuXHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcblx0XHR2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5wcm9wcy5pZCwgICB0aGlzLnByb3BzLmZsb3dLZXkpO1xyXG5cdFx0aWYoZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHR7XHJcblx0XHRcdGZvcih2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0dGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSBcclxuICAgIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKClcclxuICAgIHtcclxuXHJcbiAgICB9XHJcblxyXG5cdGdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lIDogc3RyaW5nKVxyXG5cdHtcclxuXHRcdGlmKHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSlcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuICAgICAgIFxyXG4gICAgcmVuZGVyKClcclxuICAgIHtcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgXHJcbiAgICAgICAgLy9nZXQgYWxsIG91dGNvbWVzIC0gdGhlcmUncyAyIHR5cGVzIC0gcGVyIHJvdyBhbmQgYnVsaywgYnVsayBnbyBhcyBidXR0b25zIG9uIHRvcFxyXG4gICAgICAgIHZhciBvdXRjb21lcyA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZXModGhpcy5jb21wb25lbnRJZCwgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHRvcGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93QnV0dG9ucyA9IFtdO1xyXG5cclxuICAgICAgICB2YXIgZGJsQ2xpY2sgOiBhbnk7XHJcbiAgICAgICAgdmFyIGNsaWNrIDogYW55O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vbG9vcCBvdmVyIG91dGNvbWVzXHJcbiAgICAgICAgZm9yKHZhciBvUG9zID0gMCA7IG9Qb3MgPCBvdXRjb21lcy5sZW5ndGggOyBvUG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG91dGNvbWVzW29Qb3NdO1xyXG4gICAgICAgICAgICBpZihvdXRjb21lLmlzQnVsa0FjdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy90b3AgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaCg8c3BhbiBjbGFzc05hbWU9e2NsYXNzTmFtZX0gb25DbGljaz17dGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpfSB0aXRsZT17b3V0Y29tZS5sYWJlbH0+PC9zcGFuPilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vbXVzdCBiZSBhIHJvdyBidXR0b24sIGl0J3MgYWN0aW9uIGF0dHJpYnV0ZSB3aWxsIHRlbGwgaWYgaXQgc2hvdWxkIGJlIHRoZSBET1VCTEUtQ0xJQ0sgZXZlbnRcclxuICAgICAgICAgICAgICAgIHN3aXRjaChvdXRjb21lLmF0dHJpYnV0ZXNbXCJhY3Rpb25cIl0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkNMSUNLXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJET1VCTEUtQ0xJQ0tcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9jYW50IGhhdmUgZG91YmxlIGNsaWNrIGZvciBtdWx0aSBzZWxlY3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gZmFsc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRibENsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcImxvZy1pblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wYnV0dG9ucy5wdXNoKDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBvbkNsaWNrPXt0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCl9IHRpdGxlPXtvdXRjb21lLmxhYmVsfT48L3NwYW4+KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IG9uQ2xpY2s9e3RoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKX0gdGl0bGU9e291dGNvbWUubGFiZWx9Pjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd0J1dHRvbnMucHVzaChidXR0b24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BidXR0b25zLnB1c2goPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IG9uQ2xpY2s9e3RoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKX0gdGl0bGU9e291dGNvbWUubGFiZWx9Pjwvc3Bhbj4pIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGxhYmVsIDogYW55O1xyXG4gICAgICAgIHZhciBsYmwgOiBhbnkgPSBudWxsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vaWYgdGhlIGNvbXBvbmVudCBoYXMgYSBsYWJlbCB0aGVuIHB1dCBpdCBpbiB0aGUgdGl0bGUgYmFyXHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmxhYmVsICYmIGZsb3dNb2RlbC5sYWJlbC5sZW5ndGg+MClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxibCA9IDxzcGFuPntmbG93TW9kZWwubGFiZWx9PC9zcGFuPjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vY3JlYXRlIHRoZSB0aXRsZSBiYXIgb2JqZWN0XHJcbiAgICAgICAgbGFiZWwgPSA8ZGl2IGNsYXNzTmFtZT1cImV0LWNhcHRpb24tZGl2XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJldC1jYXB0aW9uXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtsYmx9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJldC1idXR0b24tYmFyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHt0b3BidXR0b25zfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgXHJcblxyXG5cclxuICAgICAgICB2YXIgaGVhZGVycyA9IFtdO1xyXG4gICAgICAgIHZhciByb3dzID0gW107XHJcbiAgICAgICAgdmFyIGNvbHMgOiBhbnkgPSBbXTtcclxuICAgICAgICB2YXIgY29sRGVmIDogYW55O1xyXG4gICAgICAgIHZhciBwb3MgPSAwO1xyXG4gICAgICAgIHZhciByb3cgOiBhbnk7XHJcbiAgICAgICAgdmFyIHJvd0lkIDogYW55O1xyXG4gICAgICAgIHZhciB2YWxzID0gW107XHJcblxyXG4gICAgICAgIC8vaGVhZGVyIHJvd1xyXG4gICAgICAgIC8vYWRkIHNwYWNlciBmb3IgbXVsdGkgc2VsZWN0IGlmIG5lZWRlZFxyXG4gICAgICAgIGlmKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1oZWFkZXItY2hlY2tib3hcIj48aW5wdXQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2hlY2tib3hcIiB0eXBlPVwiY2hlY2tib3hcIiBvbkNsaWNrPXt0aGlzLnRvZ2dsZVNlbGVjdEFsbC5iaW5kKHRoaXMpfT48L2lucHV0PjwvdGQ+KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkIGJ1dHRvbiBzcGFjZXIgaWYgdGhlcmUgYXJlIGFueSByb3cgYnV0dG9uc1xyXG4gICAgICAgIC8vaWYgdGhlcmUgYXJlIGJ1dHRvbnMgdGhlbiBhZGQgYmxhbmsgaGVhZGVyXHJcbiAgICAgICAgaWYocm93QnV0dG9ucyAmJiByb3dCdXR0b25zLmxlbmd0aCA+IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goPHRkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRlclwiPjwvdGQ+KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vYWRkIGVhY2ggY29sdW1uXHJcbiAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwuY29sdW1ucy5sZW5ndGggOyBwb3MrKylcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIGNvbE5hbWUgPSBmbG93TW9kZWwuY29sdW1uc1twb3NdLmRldmVsb3Blck5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzb3J0SWNvbiA6IGFueTtcclxuXHJcbiAgICAgICAgICAgIC8vaXMgdGhpcyB0aGUgc29ydGVkIGNvbHVtbiAtIGlmIHNvIHRoZW4gd2UgbmVlZCB0byBzaG93IHRoZSBzb3J0IGRpcmVjdGlvbiBpY29uXHJcbiAgICAgICAgICAgIGlmKHRoaXMuc29ydEl0ZW0gJiYgdGhpcy5zb3J0SXRlbT09Y29sTmFtZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zb3J0RGlyZWN0aW9uID09IFwiREVTQ1wiKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy1kb3duXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy11cFwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHNvcnRJY29uID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb2xzW2Zsb3dNb2RlbC5jb2x1bW5zW3Bvc10uZGV2ZWxvcGVyTmFtZV0gPSBmbG93TW9kZWwuY29sdW1uc1twb3NdO1xyXG5cclxuICAgICAgICAgICAgLy9lYWNoIGhlYWRlciBoYXMgYSBjYXB0aW9uIGFuZCBhIHNvcnQgZGlyZWN0aW9uIGluZGljYXRvclxyXG4gICAgICAgICAgICB2YXIgaGVhZGVyID0gPHRoIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRlclwiIGRhdGEtY29sdW1uLW5hbWU9e2NvbE5hbWV9IG9uQ2xpY2s9e3RoaXMuc29ydC5iaW5kKHRoaXMpfT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eydmbG9hdCc6ICdsZWZ0J319PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57Zmxvd01vZGVsLmNvbHVtbnNbcG9zXS5sYWJlbH08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT17eydmbG9hdCc6ICdyaWdodCd9fT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3NvcnRJY29ufVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RoPjtcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goaGVhZGVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vYm9keVxyXG4gICAgICAgIGlmKGZsb3dNb2RlbC5vYmplY3REYXRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwub2JqZWN0RGF0YS5sZW5ndGggOyBwb3MrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcm93PWZsb3dNb2RlbC5vYmplY3REYXRhW3Bvc107XHJcblxyXG4gICAgICAgICAgICAgICAgcm93SWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShyb3cucHJvcGVydGllcywgdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YWxzID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgLy9pZiB0aGUgcm93aWQgaXMgaW4gc2VsZWN0ZWQgdGhlbiBzaG93IGNoZWNrZWRcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja2VkIDogYW55O1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpIDwgMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9hZGQgZWl0aGVyIHRoZSBjaGVjayBib3hlcyBvciByb3cgYnV0dG9uc1xyXG4gICAgICAgICAgICAgICAgaWYoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFscy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1jZWxsLWNoZWNrYm94XCI+PGlucHV0IGNsYXNzTmFtZT1cImV0LXRhYmxlLWNoZWNrYm94XCIgdHlwZT1cImNoZWNrYm94XCIgY2hlY2tlZD17Y2hlY2tlZH0gb25DbGljaz17dGhpcy50b2dnbGVTZWxlY3RJdGVtLmJpbmQodGhpcyl9PjwvaW5wdXQ+PC90ZD4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHJvd0J1dHRvbnMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaCg8dGQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2VsbFwiPntyb3dCdXR0b25zfTwvdGQ+KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGZvcih2YXIgaVBvcyA9IDAgOyBpUG9zIDwgcm93LnByb3BlcnRpZXMubGVuZ3RoIDsgaVBvcysrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbERlZiA9IGNvbHNbcm93LnByb3BlcnRpZXNbaVBvc10uZGV2ZWxvcGVyTmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIGNvbERlZiAmJiBjb2xEZWYuaXNEaXNwbGF5VmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihjb2xEZWYuY29tcG9uZW50VHlwZSA9PSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxzLnB1c2goPHRkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWNlbGxcIj57cm93LnByb3BlcnRpZXNbaVBvc10uY29udGVudFZhbHVlfTwvdGQ+KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21wb25lbnQgPSBSZWFjdC5jcmVhdGVFbGVtZW50KG1hbnl3aG8uY29tcG9uZW50LmdldEJ5TmFtZShjb2xEZWYuY29tcG9uZW50VHlwZSksIHJvdy5wcm9wZXJ0aWVzW2lQb3NdLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaCg8dGQgY2xhc3NOYW1lPVwiZXQtdGFibGUtY2VsbFwiPntjb21wb25lbnR9PC90ZD4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImV0LXRhYmxlLXJvd1wiO1xyXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZEl0ZW1zICYmIHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA+PTApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lICs9IFwiIGV0LXRhYmxlLXJvdy1zZWxlY3RlZFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlPSBcIkNsaWNrIHRvIHNlbGVjdCwgRG91YmxlLUNsaWNrIHRvIG9wZW5cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZT0gXCJDbGljayB0byBzZWxlY3RcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vY3JlYXRlIHJvdyBvYmplY3QsIG5vdGUgd2UgYXJlIGJpbmRpbmcgc2VsZWN0IHRvIGl0cyBjbGljayBhbmQgdGhlIGRibGNsaWNrIHZhbHVlIChhbiBvdXRjb21lIGlkKSB0byBkb3VibGUgY2xpY2suICBJdCBtYXkgYmUgbnVsbCBidXQgdGhhdHMgZmluZVxyXG4gICAgICAgICAgICAgICAgdmFyIHIgPSA8dHIgY2xhc3NOYW1lPXtjbGFzc05hbWV9IGRhdGEtcm93SWQ9e3Jvd0lkfSBkYXRhLW9iamVjdERhdGE9e3Jvd30gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnNlbGVjdFJvdy5iaW5kKHRoaXMsY2xpY2spfSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRG91YmxlQ2xpY2s9e3RoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLGRibENsaWNrKX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0aXRsZX0+e3ZhbHN9PC90cj47XHJcblxyXG4gICAgICAgICAgICAgICAgcm93cy5wdXNoKHIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciByID0gPHRyIGNsYXNzTmFtZT17Y2xhc3NOYW1lfT48dGQgY29sU3Bhbj17T2JqZWN0LmtleXMoY29scykubGVuZ3RofT5ObyBXb3JrIEl0ZW1zPC90ZD48L3RyPjtcclxuICAgICAgICAgICAgcm93cy5wdXNoKHIpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vY29uc3RydWN0IHRoZSB0YWJsZVxyXG4gICAgICAgIHZhciB0YWJsZSA6IGFueSA9ICAgPGRpdiBjbGFzc05hbWU9XCJldC10YWJsZS1kaXZcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPVwiZXQtdGFibGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzc05hbWU9XCJldC10YWJsZS1oZWFkZXItcm93XCI+e2hlYWRlcnN9PC90cj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5IGNsYXNzTmFtZT1cImV0LXRhYmxlLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyb3dzfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuXHJcblxyXG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImV0XCI+XHJcbiAgICAgICAgICAgICAgICAgICAge2xhYmVsfVxyXG4gICAgICAgICAgICAgICAgICAgIHt0YWJsZX1cclxuICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgLy9nZW5lcmljIGhhbmRsZXIgdG8gdHJpZ2dlciBhbiBvdXRjb21lXHJcbiAgICB0cmlnZ2VyT3V0Y29tZShvdXRjb21lSWQgOiBhbnksIGV2ZW50IDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIC8vaWYgbm8gb3V0Y29tZSBpZCBqdXN0IHF1aXRcclxuICAgICAgICBpZighb3V0Y29tZUlkIHx8IG91dGNvbWVJZC5sZW5ndGg8MSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJvd0lkIDogYW55O1xyXG4gICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgcm93S2V5RmllbGQgPSB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIik7XHJcblxyXG4gICAgICAgIHZhciBuZXdTdGF0ZSA6IGFueTtcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YUFycmF5ID0gW107XHJcbiAgICAgICAgdmFyIG9iamVjdERhdGEgOiBhbnk7XHJcblxyXG4gICAgICAgIGZvcih2YXIga2V5IGluIHRoaXMuc2VsZWN0ZWRJdGVtcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGE9dGhpcy5nZXRPYmplY3REYXRhQnlLZXkoZmxvd01vZGVsLm9iamVjdERhdGEsIHJvd0tleUZpZWxkLCB0aGlzLnNlbGVjdGVkSXRlbXNba2V5XSk7XHJcbiAgICAgICAgICAgIC8vY2xvbmUgZGF0YVxyXG4gICAgICAgICAgICBvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3REYXRhKSk7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGEuaXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGFBcnJheS5wdXNoKG9iamVjdERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgXHJcbiAgICAgICAgbmV3U3RhdGUgPSB7XHJcblx0XHRcdG9iamVjdERhdGE6IG9iamVjdERhdGFBcnJheVxyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0bWFueXdoby5zdGF0ZS5zZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgbmV3U3RhdGUsIHRoaXMuZmxvd0tleSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgIGlmKG9iamVjdERhdGFBcnJheSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKG91dGNvbWVJZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBtYW55d2hvLm1vZGVsLmdldE91dGNvbWUob3V0Y29tZUlkLCB0aGlzLmZsb3dLZXkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKG91dGNvbWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFueXdoby5jb21wb25lbnQub25PdXRjb21lKG91dGNvbWUsIG9iamVjdERhdGFBcnJheSAsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNvcnQoZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgaWYodGhpcy5zb3J0RGlyZWN0aW9uICYmIHRoaXMuc29ydERpcmVjdGlvbiA9PSBcIkFTQ1wiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9uPVwiREVTQ1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb249XCJBU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZVNlbGVjdEFsbChldmVudCA6IGFueSlcclxuICAgIHtcclxuICAgICAgICBpZihldmVudC5jdXJyZW50VGFyZ2V0LmNoZWNrZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL2NoZWNrIGFsbFxyXG4gICAgICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5vYmplY3REYXRhLmxlbmd0aCA7IHBvcysrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93PWZsb3dNb2RlbC5vYmplY3REYXRhW3Bvc107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJvd0lkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkocm93LnByb3BlcnRpZXMsIHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKSkuY29udGVudFZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvL2Egcm93IHdhcyBzZWxlY3RlZCwgc3RvcmUgaXQncyBpZCBhdCBjb21wb25lbnQgbGV2ZWwgYW5kIHJlZHJhd1xyXG4gICAgc2VsZWN0Um93KG91dGNvbWVJZCA6IGFueSwgZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0ID09IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9vbmx5IG9uZSBjYW4gYmUgc2VsZWN0ZWRcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKSA8IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMucHVzaChldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyT3V0Y29tZShvdXRjb21lSWQsIGV2ZW50KTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlU2VsZWN0SXRlbShldmVudCA6IGFueSlcclxuICAgIHtcclxuICAgICAgICB2YXIgcm93SWQ9ZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSB8fCBldmVudC5jdXJyZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKTtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgaWR4ID0gdGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMuc3BsaWNlKGlkeCwxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy90aGlzLnNvcnRJdGVtID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uLW5hbWUnKTtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vaGVscGVyIHRvIGdldCBhIHNwZWNpZmljIG9iamVjdCBkYXRhIGl0ZW0gZ2l2ZW4gYSBmaWVsZD12YWx1ZSBjcml0ZXJpYSBcclxuICAgIGdldE9iamVjdERhdGFCeUtleShvYmplY3REYXRhIDogYW55LCBmaWVsZE5hbWUgOiBzdHJpbmcsIHZhbHVlIDogc3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBvZCA6IGFueTtcclxuICAgICAgICB2YXIgdmFsIDogYW55O1xyXG4gICAgICAgIC8vbG9vcCBvdmVyIGRhdGEgaXRlbXNcclxuICAgICAgICBmb3IodmFyIHBvcyA9IDAgOyBwb3MgPCBvYmplY3REYXRhLmxlbmd0aDsgcG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvZCA9IG9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgdmFsID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkob2QucHJvcGVydGllcywgZmllbGROYW1lKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIGlmKHZhbD09dmFsdWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgXHJcbn1cclxuXHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdFbmhhbmNlZFRhYmxlJywgRW5oYW5jZWRUYWJsZSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBFbmhhbmNlZFRhYmxlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9FbmhhbmNlZFRhYmxlLnRzeCIsIm1vZHVsZS5leHBvcnRzID0gUmVhY3Q7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJSZWFjdFwiXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=