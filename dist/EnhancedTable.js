!function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(1))},function(e,t,o){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=o(2);o(3);var a=function(e){function t(t){var o=e.call(this,t)||this;o.componentId="",o.flowKey="",o.attributes={},o.selectedItems=[],o.sortItem=null,o.sortDirection=null,o.text="",o.componentId=t.id,o.flowKey=t.flowKey;var n=manywho.model.getComponent(o.props.id,o.props.flowKey);if(n.attributes)for(var r in n.attributes)o.attributes[r]=n.attributes[r];return o}return n(t,e),t.prototype.componentDidMount=function(){this.forceUpdate()},t.prototype.componentDidUpdate=function(){},t.prototype.getAttribute=function(e){return this.attributes[e]?this.attributes[e]:null},t.prototype.render=function(){for(var e,t,o=manywho.model.getComponent(this.componentId,this.flowKey),n=(manywho.state.getComponent(this.componentId,this.flowKey),manywho.model.getOutcomes(this.componentId,this.flowKey)),a=[],l=[],s=0;s<n.length;s++){var i=n[s];if(i.isBulkAction){var c=i.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button";a.push(r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this),title:i.label}))}else switch(i.attributes.action){case"CLICK":t=i.id;break;case"DOUBLE-CLICK":if(0==o.isMultiSelect)e=i.id;else{var c=i.attributes.icon||"log-in",u="glyphicon glyphicon-"+c+" et-button-bar-button";a.push(r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label}))}break;default:if(0==o.isMultiSelect){var c=i.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button",h=r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label});l.push(h)}else{var c=i.attributes.icon||"wrench",u="glyphicon glyphicon-"+c+" et-button-bar-button";a.push(r.createElement("span",{className:u,onClick:this.triggerOutcome.bind(this,i.id),title:i.label}))}}}var p,m=null;o.label&&o.label.length>0&&(m=r.createElement("span",null,o.label)),p=r.createElement("div",{className:"et-caption-div"},r.createElement("div",{className:"et-caption"},m),r.createElement("div",{className:"et-button-bar"},a));var d,b,f,g=[],y=[],v=[],w=0,I=[];for(o.isMultiSelect&&g.push(r.createElement("td",{className:"et-table-header-checkbox"},r.createElement("input",{className:"et-table-checkbox",type:"checkbox",onClick:this.toggleSelectAll.bind(this)}))),l&&l.length>0&&g.push(r.createElement("td",{className:"et-table-header"})),w=0;w<o.columns.length;w++){var E,O=o.columns[w].developerName;E=this.sortItem&&this.sortItem==O?"DESC"==this.sortDirection?r.createElement("span",{className:"glyphicon glyphicon-arrow-down"}):r.createElement("span",{className:"glyphicon glyphicon-arrow-up"}):null,v[o.columns[w].developerName]=o.columns[w];var N=r.createElement("th",{className:"et-table-header","data-column-name":O,onClick:this.sort.bind(this)},r.createElement("div",null,r.createElement("div",{style:{float:"left"}},r.createElement("span",null,o.columns[w].label)),r.createElement("div",{style:{float:"right"}},E)));g.push(N)}for(w=0;w<o.objectData.length;w++){b=o.objectData[w],f=manywho.utils.getObjectDataProperty(b.properties,this.getAttribute("Row Key")).contentValue,I=[];var C;C=!(this.selectedItems.indexOf(f)<0),o.isMultiSelect?I.push(r.createElement("td",{className:"et-table-cell-checkbox"},r.createElement("input",{className:"et-table-checkbox",type:"checkbox",checked:C,onClick:this.toggleSelectItem.bind(this)}))):I.push(r.createElement("td",{className:"et-table-cell"},l));for(var D=0;D<b.properties.length;D++)(d=v[b.properties[D].developerName])&&d.isDisplayValue&&I.push(r.createElement("td",{className:"et-table-cell"},b.properties[D].contentValue));var u="et-table-row";this.selectedItems&&this.selectedItems.indexOf(f)>=0&&(u+=" et-table-row-selected");var k="";k=1==o.isMultiSelect?"Click to select, Double-Click to open":"Click to select";var x=r.createElement("tr",{className:u,"data-rowId":f,"data-objectData":b,onClick:this.selectRow.bind(this,t),onDoubleClick:this.triggerOutcome.bind(this,e),title:k},I);y.push(x)}var K=r.createElement("div",{className:"et-table-div"},r.createElement("table",{className:"et-table"},r.createElement("thead",{className:"et-table-head"},r.createElement("tr",{className:"et-table-header-row"},g)),r.createElement("tbody",{className:"et-table-body"},y)));return r.createElement("div",{className:"et"},p,K)},t.prototype.triggerOutcome=function(e,t){if(e&&!(e.length<1)){var o,n,r=manywho.model.getComponent(this.componentId,this.flowKey),a=this.getAttribute("Row Key"),l=[];for(var s in this.selectedItems)n=this.getObjectDataByKey(r.objectData,a,this.selectedItems[s]),n=JSON.parse(JSON.stringify(n)),n.isSelected=!0,l.push(n);if(o={objectData:l},manywho.state.setComponent(this.componentId,o,this.flowKey,!0),l&&l.length>0&&e){var i=manywho.model.getOutcome(e,this.flowKey);i&&manywho.component.onOutcome(i,null,this.flowKey)}this.forceUpdate()}},t.prototype.sort=function(e){this.sortItem=e.currentTarget.getAttribute("data-column-name"),this.sortDirection&&"ASC"==this.sortDirection?this.sortDirection="DESC":this.sortDirection="ASC",this.forceUpdate()},t.prototype.toggleSelectAll=function(e){if(e.currentTarget.checked)for(var t=manywho.model.getComponent(this.componentId,this.flowKey),o=0;o<t.objectData.length;o++){var n=t.objectData[o],r=manywho.utils.getObjectDataProperty(n.properties,this.getAttribute("Row Key")).contentValue;this.selectedItems.indexOf(r)<0&&this.selectedItems.push(r)}else this.selectedItems=[];return this.forceUpdate(),!1},t.prototype.selectRow=function(e,t){0==manywho.model.getComponent(this.componentId,this.flowKey).isMultiSelect&&(this.selectedItems=[]),this.selectedItems.indexOf(t.currentTarget.getAttribute("data-rowId"))<0&&this.selectedItems.push(t.currentTarget.getAttribute("data-rowId")),this.triggerOutcome(e,t),this.forceUpdate()},t.prototype.toggleSelectItem=function(e){var t=e.currentTarget.getAttribute("data-rowId")||e.currentTarget.parentElement.parentElement.getAttribute("data-rowId");if(this.selectedItems.indexOf(t)<0)this.selectedItems.push(t);else{var o=this.selectedItems.indexOf(t);this.selectedItems.splice(o,1)}e.stopPropagation(),this.forceUpdate()},t.prototype.getObjectDataByKey=function(e,t,o){for(var n,r=0;r<e.length;r++)if(n=e[r],manywho.utils.getObjectDataProperty(n.properties,t).contentValue==o)return n;return null},t}(r.Component);manywho.component.register("EnhancedTable",a),t.default=a},function(e,t){e.exports=React},function(e,t){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vRW5oYW5jZWRUYWJsZS5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMWI3NTIxMjczMzJjODU3OWM2MGIiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzeCIsIndlYnBhY2s6Ly8vLi9zcmMvRW5oYW5jZWRUYWJsZS50c3giLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUmVhY3RcIiJdLCJuYW1lcyI6WyJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidmFsdWUiLCJfX2V4dGVuZHMiLCJ0aGlzIiwiZXh0ZW5kU3RhdGljcyIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJiIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIlJlYWN0IiwiRW5oYW5jZWRUYWJsZSIsIl9zdXBlciIsInByb3BzIiwiX3RoaXMiLCJjb21wb25lbnRJZCIsImZsb3dLZXkiLCJhdHRyaWJ1dGVzIiwic2VsZWN0ZWRJdGVtcyIsInNvcnRJdGVtIiwic29ydERpcmVjdGlvbiIsInRleHQiLCJpZCIsImZsb3dNb2RlbCIsIm1hbnl3aG8iLCJtb2RlbCIsImdldENvbXBvbmVudCIsImtleSIsImNvbXBvbmVudERpZE1vdW50IiwiZm9yY2VVcGRhdGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGVOYW1lIiwicmVuZGVyIiwiZGJsQ2xpY2siLCJjbGljayIsIm91dGNvbWVzIiwic3RhdGUiLCJnZXRPdXRjb21lcyIsInRvcGJ1dHRvbnMiLCJyb3dCdXR0b25zIiwib1BvcyIsImxlbmd0aCIsIm91dGNvbWUiLCJpc0J1bGtBY3Rpb24iLCJpY29uIiwiY2xhc3NOYW1lIiwicHVzaCIsImNyZWF0ZUVsZW1lbnQiLCJvbkNsaWNrIiwidHJpZ2dlck91dGNvbWUiLCJiaW5kIiwidGl0bGUiLCJsYWJlbCIsImlzTXVsdGlTZWxlY3QiLCJidXR0b24iLCJsYmwiLCJjb2xEZWYiLCJyb3ciLCJyb3dJZCIsImhlYWRlcnMiLCJyb3dzIiwiY29scyIsInBvcyIsInZhbHMiLCJ0eXBlIiwidG9nZ2xlU2VsZWN0QWxsIiwiY29sdW1ucyIsInNvcnRJY29uIiwiY29sTmFtZSIsImRldmVsb3Blck5hbWUiLCJoZWFkZXIiLCJkYXRhLWNvbHVtbi1uYW1lIiwic29ydCIsInN0eWxlIiwiZmxvYXQiLCJvYmplY3REYXRhIiwidXRpbHMiLCJnZXRPYmplY3REYXRhUHJvcGVydHkiLCJwcm9wZXJ0aWVzIiwiY29udGVudFZhbHVlIiwiY2hlY2tlZCIsImluZGV4T2YiLCJ0b2dnbGVTZWxlY3RJdGVtIiwiaVBvcyIsImlzRGlzcGxheVZhbHVlIiwiciIsImRhdGEtcm93SWQiLCJkYXRhLW9iamVjdERhdGEiLCJzZWxlY3RSb3ciLCJvbkRvdWJsZUNsaWNrIiwidGFibGUiLCJvdXRjb21lSWQiLCJldmVudCIsIm5ld1N0YXRlIiwicm93S2V5RmllbGQiLCJvYmplY3REYXRhQXJyYXkiLCJnZXRPYmplY3REYXRhQnlLZXkiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJpc1NlbGVjdGVkIiwic2V0Q29tcG9uZW50IiwiZ2V0T3V0Y29tZSIsImNvbXBvbmVudCIsIm9uT3V0Y29tZSIsImN1cnJlbnRUYXJnZXQiLCJwYXJlbnRFbGVtZW50IiwiaWR4Iiwic3BsaWNlIiwic3RvcFByb3BhZ2F0aW9uIiwiZmllbGROYW1lIiwib2QiLCJDb21wb25lbnQiLCJyZWdpc3RlciIsImRlZmF1bHQiXSwi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TSxTQUFVbEMsRUFBUUQiLCJmaWxlIjoiRW5oYW5jZWRUYWJsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0aTogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9XG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4vKioqKioqLyBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbi8qKioqKiovIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbi8qKioqKiovIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbi8qKioqKiovIFx0XHRcdH0pO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuLyoqKioqKi8gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuLyoqKioqKi8gXHRcdHJldHVybiBnZXR0ZXI7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cclxuZnVuY3Rpb24gX19leHBvcnQobSkge1xyXG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAoIWV4cG9ydHMuaGFzT3duUHJvcGVydHkocCkpIGV4cG9ydHNbcF0gPSBtW3BdO1xyXG59XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuX19leHBvcnQoX193ZWJwYWNrX3JlcXVpcmVfXygxKSk7XHJcblxuXG4vKioqLyB9KSxcbi8qIDEgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcclxuX193ZWJwYWNrX3JlcXVpcmVfXygzKTtcclxudmFyIEVuaGFuY2VkVGFibGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRW5oYW5jZWRUYWJsZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEVuaGFuY2VkVGFibGUocHJvcHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jb21wb25lbnRJZCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIF90aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICBfdGhpcy5zb3J0SXRlbSA9IG51bGw7XHJcbiAgICAgICAgX3RoaXMuc29ydERpcmVjdGlvbiA9IG51bGw7XHJcbiAgICAgICAgX3RoaXMudGV4dCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuY29tcG9uZW50SWQgPSBwcm9wcy5pZDtcclxuICAgICAgICBfdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuICAgICAgICAvL3B1c2ggYXR0cmlidXRlcyBpbnRvIGtleWVkIG1hcCBcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQoX3RoaXMucHJvcHMuaWQsIF90aGlzLnByb3BzLmZsb3dLZXkpO1xyXG4gICAgICAgIGlmIChmbG93TW9kZWwuYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmxvd01vZGVsLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJpYnV0ZXNba2V5XSA9IGZsb3dNb2RlbC5hdHRyaWJ1dGVzW2tleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLmNvbXBvbmVudERpZFVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGZsb3dTdGF0ZSA9IG1hbnl3aG8uc3RhdGUuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgLy9nZXQgYWxsIG91dGNvbWVzIC0gdGhlcmUncyAyIHR5cGVzIC0gcGVyIHJvdyBhbmQgYnVsaywgYnVsayBnbyBhcyBidXR0b25zIG9uIHRvcFxyXG4gICAgICAgIHZhciBvdXRjb21lcyA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZXModGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgdG9wYnV0dG9ucyA9IFtdO1xyXG4gICAgICAgIHZhciByb3dCdXR0b25zID0gW107XHJcbiAgICAgICAgdmFyIGRibENsaWNrO1xyXG4gICAgICAgIHZhciBjbGljaztcclxuICAgICAgICAvL2xvb3Agb3ZlciBvdXRjb21lc1xyXG4gICAgICAgIGZvciAodmFyIG9Qb3MgPSAwOyBvUG9zIDwgb3V0Y29tZXMubGVuZ3RoOyBvUG9zKyspIHtcclxuICAgICAgICAgICAgdmFyIG91dGNvbWUgPSBvdXRjb21lc1tvUG9zXTtcclxuICAgICAgICAgICAgaWYgKG91dGNvbWUuaXNCdWxrQWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAvL3RvcCBidXR0b25cclxuICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcIndyZW5jaFwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgdG9wYnV0dG9ucy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIG9uQ2xpY2s6IHRoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzKSwgdGl0bGU6IG91dGNvbWUubGFiZWwgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy9tdXN0IGJlIGEgcm93IGJ1dHRvbiwgaXQncyBhY3Rpb24gYXR0cmlidXRlIHdpbGwgdGVsbCBpZiBpdCBzaG91bGQgYmUgdGhlIERPVUJMRS1DTElDSyBldmVudFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChvdXRjb21lLmF0dHJpYnV0ZXNbXCJhY3Rpb25cIl0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ0xJQ0tcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2sgPSBvdXRjb21lLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRE9VQkxFLUNMSUNLXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2FudCBoYXZlIGRvdWJsZSBjbGljayBmb3IgbXVsdGkgc2VsZWN0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJsQ2xpY2sgPSBvdXRjb21lLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwibG9nLWluXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BidXR0b25zLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgb25DbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpLCB0aXRsZTogb3V0Y29tZS5sYWJlbCB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0ID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lLCBvbkNsaWNrOiB0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCksIHRpdGxlOiBvdXRjb21lLmxhYmVsIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93QnV0dG9ucy5wdXNoKGJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lLCBvbkNsaWNrOiB0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCksIHRpdGxlOiBvdXRjb21lLmxhYmVsIH0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbGFiZWw7XHJcbiAgICAgICAgdmFyIGxibCA9IG51bGw7XHJcbiAgICAgICAgLy9pZiB0aGUgY29tcG9uZW50IGhhcyBhIGxhYmVsIHRoZW4gcHV0IGl0IGluIHRoZSB0aXRsZSBiYXJcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmxhYmVsICYmIGZsb3dNb2RlbC5sYWJlbC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGxibCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIG51bGwsIGZsb3dNb2RlbC5sYWJlbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vY3JlYXRlIHRoZSB0aXRsZSBiYXIgb2JqZWN0XHJcbiAgICAgICAgbGFiZWwgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LWNhcHRpb24tZGl2XCIgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJldC1jYXB0aW9uXCIgfSwgbGJsKSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJldC1idXR0b24tYmFyXCIgfSwgdG9wYnV0dG9ucykpO1xyXG4gICAgICAgIHZhciBoZWFkZXJzID0gW107XHJcbiAgICAgICAgdmFyIHJvd3MgPSBbXTtcclxuICAgICAgICB2YXIgY29scyA9IFtdO1xyXG4gICAgICAgIHZhciBjb2xEZWY7XHJcbiAgICAgICAgdmFyIHBvcyA9IDA7XHJcbiAgICAgICAgdmFyIHJvdztcclxuICAgICAgICB2YXIgcm93SWQ7XHJcbiAgICAgICAgdmFyIHZhbHMgPSBbXTtcclxuICAgICAgICAvL2hlYWRlciByb3dcclxuICAgICAgICAvL2FkZCBzcGFjZXIgZm9yIG11bHRpIHNlbGVjdCBpZiBuZWVkZWRcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1oZWFkZXItY2hlY2tib3hcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWNoZWNrYm94XCIsIHR5cGU6IFwiY2hlY2tib3hcIiwgb25DbGljazogdGhpcy50b2dnbGVTZWxlY3RBbGwuYmluZCh0aGlzKSB9KSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBhZGQgYnV0dG9uIHNwYWNlciBpZiB0aGVyZSBhcmUgYW55IHJvdyBidXR0b25zXHJcbiAgICAgICAgLy9pZiB0aGVyZSBhcmUgYnV0dG9ucyB0aGVuIGFkZCBibGFuayBoZWFkZXJcclxuICAgICAgICBpZiAocm93QnV0dG9ucyAmJiByb3dCdXR0b25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1oZWFkZXJcIiB9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vYWRkIGVhY2ggY29sdW1uXHJcbiAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwuY29sdW1ucy5sZW5ndGg7IHBvcysrKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2xOYW1lID0gZmxvd01vZGVsLmNvbHVtbnNbcG9zXS5kZXZlbG9wZXJOYW1lO1xyXG4gICAgICAgICAgICB2YXIgc29ydEljb247XHJcbiAgICAgICAgICAgIC8vaXMgdGhpcyB0aGUgc29ydGVkIGNvbHVtbiAtIGlmIHNvIHRoZW4gd2UgbmVlZCB0byBzaG93IHRoZSBzb3J0IGRpcmVjdGlvbiBpY29uXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNvcnRJdGVtICYmIHRoaXMuc29ydEl0ZW0gPT0gY29sTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc29ydERpcmVjdGlvbiA9PSBcIkRFU0NcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy1kb3duXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzb3J0SWNvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tYXJyb3ctdXBcIiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNvcnRJY29uID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb2xzW2Zsb3dNb2RlbC5jb2x1bW5zW3Bvc10uZGV2ZWxvcGVyTmFtZV0gPSBmbG93TW9kZWwuY29sdW1uc1twb3NdO1xyXG4gICAgICAgICAgICAvL2VhY2ggaGVhZGVyIGhhcyBhIGNhcHRpb24gYW5kIGEgc29ydCBkaXJlY3Rpb24gaW5kaWNhdG9yXHJcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGhcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZGVyXCIsIFwiZGF0YS1jb2x1bW4tbmFtZVwiOiBjb2xOYW1lLCBvbkNsaWNrOiB0aGlzLnNvcnQuYmluZCh0aGlzKSB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBzdHlsZTogeyAnZmxvYXQnOiAnbGVmdCcgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCBudWxsLCBmbG93TW9kZWwuY29sdW1uc1twb3NdLmxhYmVsKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IHN0eWxlOiB7ICdmbG9hdCc6ICdyaWdodCcgfSB9LCBzb3J0SWNvbikpKTtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKGhlYWRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vYm9keVxyXG4gICAgICAgIGZvciAocG9zID0gMDsgcG9zIDwgZmxvd01vZGVsLm9iamVjdERhdGEubGVuZ3RoOyBwb3MrKykge1xyXG4gICAgICAgICAgICByb3cgPSBmbG93TW9kZWwub2JqZWN0RGF0YVtwb3NdO1xyXG4gICAgICAgICAgICByb3dJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHJvdy5wcm9wZXJ0aWVzLCB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgdmFscyA9IFtdO1xyXG4gICAgICAgICAgICAvL2lmIHRoZSByb3dpZCBpcyBpbiBzZWxlY3RlZCB0aGVuIHNob3cgY2hlY2tlZFxyXG4gICAgICAgICAgICB2YXIgY2hlY2tlZDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vYWRkIGVpdGhlciB0aGUgY2hlY2sgYm94ZXMgb3Igcm93IGJ1dHRvbnNcclxuICAgICAgICAgICAgaWYgKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YWxzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInRkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWNlbGwtY2hlY2tib3hcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jaGVja2JveFwiLCB0eXBlOiBcImNoZWNrYm94XCIsIGNoZWNrZWQ6IGNoZWNrZWQsIG9uQ2xpY2s6IHRoaXMudG9nZ2xlU2VsZWN0SXRlbS5iaW5kKHRoaXMpIH0pKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YWxzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInRkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWNlbGxcIiB9LCByb3dCdXR0b25zKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICh2YXIgaVBvcyA9IDA7IGlQb3MgPCByb3cucHJvcGVydGllcy5sZW5ndGg7IGlQb3MrKykge1xyXG4gICAgICAgICAgICAgICAgY29sRGVmID0gY29sc1tyb3cucHJvcGVydGllc1tpUG9zXS5kZXZlbG9wZXJOYW1lXTtcclxuICAgICAgICAgICAgICAgIGlmIChjb2xEZWYgJiYgY29sRGVmLmlzRGlzcGxheVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFscy5wdXNoKFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1jZWxsXCIgfSwgcm93LnByb3BlcnRpZXNbaVBvc10uY29udGVudFZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZXQtdGFibGUtcm93XCI7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMgJiYgdGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpID49IDApIHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSArPSBcIiBldC10YWJsZS1yb3ctc2VsZWN0ZWRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBcIlwiO1xyXG4gICAgICAgICAgICBpZiAoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGl0bGUgPSBcIkNsaWNrIHRvIHNlbGVjdCwgRG91YmxlLUNsaWNrIHRvIG9wZW5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRpdGxlID0gXCJDbGljayB0byBzZWxlY3RcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2NyZWF0ZSByb3cgb2JqZWN0LCBub3RlIHdlIGFyZSBiaW5kaW5nIHNlbGVjdCB0byBpdHMgY2xpY2sgYW5kIHRoZSBkYmxjbGljayB2YWx1ZSAoYW4gb3V0Y29tZSBpZCkgdG8gZG91YmxlIGNsaWNrLiAgSXQgbWF5IGJlIG51bGwgYnV0IHRoYXRzIGZpbmVcclxuICAgICAgICAgICAgdmFyIHIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwidHJcIiwgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgXCJkYXRhLXJvd0lkXCI6IHJvd0lkLCBcImRhdGEtb2JqZWN0RGF0YVwiOiByb3csIG9uQ2xpY2s6IHRoaXMuc2VsZWN0Um93LmJpbmQodGhpcywgY2xpY2spLCBvbkRvdWJsZUNsaWNrOiB0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgZGJsQ2xpY2spLCB0aXRsZTogdGl0bGUgfSwgdmFscyk7XHJcbiAgICAgICAgICAgIHJvd3MucHVzaChyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9jb25zdHJ1Y3QgdGhlIHRhYmxlXHJcbiAgICAgICAgdmFyIHRhYmxlID0gUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1kaXZcIiB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGFibGVcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGVcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInRoZWFkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWhlYWRcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0clwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZS1oZWFkZXItcm93XCIgfSwgaGVhZGVycykpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInRib2R5XCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWJvZHlcIiB9LCByb3dzKSkpO1xyXG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0XCIgfSxcclxuICAgICAgICAgICAgbGFiZWwsXHJcbiAgICAgICAgICAgIHRhYmxlKTtcclxuICAgIH07XHJcbiAgICAvL2dlbmVyaWMgaGFuZGxlciB0byB0cmlnZ2VyIGFuIG91dGNvbWVcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnRyaWdnZXJPdXRjb21lID0gZnVuY3Rpb24gKG91dGNvbWVJZCwgZXZlbnQpIHtcclxuICAgICAgICAvL2lmIG5vIG91dGNvbWUgaWQganVzdCBxdWl0XHJcbiAgICAgICAgaWYgKCFvdXRjb21lSWQgfHwgb3V0Y29tZUlkLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcm93SWQ7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHJvd0tleUZpZWxkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpO1xyXG4gICAgICAgIHZhciBuZXdTdGF0ZTtcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YUFycmF5ID0gW107XHJcbiAgICAgICAgdmFyIG9iamVjdERhdGE7XHJcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuc2VsZWN0ZWRJdGVtcykge1xyXG4gICAgICAgICAgICBvYmplY3REYXRhID0gdGhpcy5nZXRPYmplY3REYXRhQnlLZXkoZmxvd01vZGVsLm9iamVjdERhdGEsIHJvd0tleUZpZWxkLCB0aGlzLnNlbGVjdGVkSXRlbXNba2V5XSk7XHJcbiAgICAgICAgICAgIC8vY2xvbmUgZGF0YVxyXG4gICAgICAgICAgICBvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3REYXRhKSk7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGEuaXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGFBcnJheS5wdXNoKG9iamVjdERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBuZXdTdGF0ZSA9IHtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YTogb2JqZWN0RGF0YUFycmF5XHJcbiAgICAgICAgfTtcclxuICAgICAgICBtYW55d2hvLnN0YXRlLnNldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCBuZXdTdGF0ZSwgdGhpcy5mbG93S2V5LCB0cnVlKTtcclxuICAgICAgICBpZiAob2JqZWN0RGF0YUFycmF5ICYmIG9iamVjdERhdGFBcnJheS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGlmIChvdXRjb21lSWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvdXRjb21lID0gbWFueXdoby5tb2RlbC5nZXRPdXRjb21lKG91dGNvbWVJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFueXdoby5jb21wb25lbnQub25PdXRjb21lKG91dGNvbWUsIG51bGwsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB0aGlzLnNvcnRJdGVtID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uLW5hbWUnKTtcclxuICAgICAgICBpZiAodGhpcy5zb3J0RGlyZWN0aW9uICYmIHRoaXMuc29ydERpcmVjdGlvbiA9PSBcIkFTQ1wiKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydERpcmVjdGlvbiA9IFwiREVTQ1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9uID0gXCJBU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnRvZ2dsZVNlbGVjdEFsbCA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0LmNoZWNrZWQpIHtcclxuICAgICAgICAgICAgLy9jaGVjayBhbGxcclxuICAgICAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5vYmplY3REYXRhLmxlbmd0aDsgcG9zKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3cgPSBmbG93TW9kZWwub2JqZWN0RGF0YVtwb3NdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvd0lkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkocm93LnByb3BlcnRpZXMsIHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMucHVzaChyb3dJZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIC8vYSByb3cgd2FzIHNlbGVjdGVkLCBzdG9yZSBpdCdzIGlkIGF0IGNvbXBvbmVudCBsZXZlbCBhbmQgcmVkcmF3XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5zZWxlY3RSb3cgPSBmdW5jdGlvbiAob3V0Y29tZUlkLCBldmVudCkge1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIGlmIChmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAvL29ubHkgb25lIGNhbiBiZSBzZWxlY3RlZFxyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvd0lkJykpIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMucHVzaChldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyT3V0Y29tZShvdXRjb21lSWQsIGV2ZW50KTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUudG9nZ2xlU2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciByb3dJZCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvd0lkJykgfHwgZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvd0lkJyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA8IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGlkeCA9IHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL3RoaXMuc29ydEl0ZW0gPSBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1jb2x1bW4tbmFtZScpO1xyXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICAvL2hlbHBlciB0byBnZXQgYSBzcGVjaWZpYyBvYmplY3QgZGF0YSBpdGVtIGdpdmVuIGEgZmllbGQ9dmFsdWUgY3JpdGVyaWEgXHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5nZXRPYmplY3REYXRhQnlLZXkgPSBmdW5jdGlvbiAob2JqZWN0RGF0YSwgZmllbGROYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciBvZDtcclxuICAgICAgICB2YXIgdmFsO1xyXG4gICAgICAgIC8vbG9vcCBvdmVyIGRhdGEgaXRlbXNcclxuICAgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBvYmplY3REYXRhLmxlbmd0aDsgcG9zKyspIHtcclxuICAgICAgICAgICAgb2QgPSBvYmplY3REYXRhW3Bvc107XHJcbiAgICAgICAgICAgIHZhbCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KG9kLnByb3BlcnRpZXMsIGZpZWxkTmFtZSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICBpZiAodmFsID09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEVuaGFuY2VkVGFibGU7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdFbmhhbmNlZFRhYmxlJywgRW5oYW5jZWRUYWJsZSk7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IEVuaGFuY2VkVGFibGU7XHJcblxuXG4vKioqLyB9KSxcbi8qIDIgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdDtcblxuLyoqKi8gfSksXG4vKiAzICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cbi8qKiovIH0pXG4vKioqKioqLyBdKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gRW5oYW5jZWRUYWJsZS5qcyIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDFiNzUyMTI3MzMyYzg1NzljNjBiIiwiZXhwb3J0ICogZnJvbSAnLi9FbmhhbmNlZFRhYmxlJztcblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2luZGV4LnRzeCIsIlxyXG5kZWNsYXJlIHZhciBtYW55d2hvOiBhbnk7XHJcblxyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCAnLi9FbmhhbmNlZFRhYmxlLmNzcyc7XHJcblxyXG5jbGFzcyBFbmhhbmNlZFRhYmxlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiBcclxueyAgIFxyXG4gICAgY29tcG9uZW50SWQ6IHN0cmluZyA9IFwiXCI7XHJcbiAgICBmbG93S2V5OiBzdHJpbmcgPVwiXCI7ICAgIFxyXG4gICAgYXR0cmlidXRlcyA6IGFueSA9IHt9O1xyXG4gICAgc2VsZWN0ZWRJdGVtczogYW55ID0gW107XHJcbiAgICBzb3J0SXRlbSA6IGFueSA9IG51bGw7XHJcbiAgICBzb3J0RGlyZWN0aW9uIDogYW55ID0gbnVsbDtcclxuXHJcbiAgICB0ZXh0IDogc3RyaW5nID0gXCJcIjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcyA6IGFueSlcclxuXHR7XHJcbiAgICAgICAgc3VwZXIocHJvcHMpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMuY29tcG9uZW50SWQgPSBwcm9wcy5pZDtcclxuICAgICAgICB0aGlzLmZsb3dLZXkgPSBwcm9wcy5mbG93S2V5O1xyXG5cclxuICAgICAgICAvL3B1c2ggYXR0cmlidXRlcyBpbnRvIGtleWVkIG1hcCBcclxuXHRcdHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLnByb3BzLmlkLCAgIHRoaXMucHJvcHMuZmxvd0tleSk7XHJcblx0XHRpZihmbG93TW9kZWwuYXR0cmlidXRlcylcclxuXHRcdHtcclxuXHRcdFx0Zm9yKHZhciBrZXkgaW4gZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHRcdHtcclxuXHRcdFx0XHR0aGlzLmF0dHJpYnV0ZXNba2V5XSA9IGZsb3dNb2RlbC5hdHRyaWJ1dGVzW2tleV07XHJcblx0XHRcdH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICBjb21wb25lbnREaWRNb3VudCgpIFxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb21wb25lbnREaWRVcGRhdGUoKVxyXG4gICAge1xyXG5cclxuICAgIH1cclxuXHJcblx0Z2V0QXR0cmlidXRlKGF0dHJpYnV0ZU5hbWUgOiBzdHJpbmcpXHJcblx0e1xyXG5cdFx0aWYodGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdKVxyXG5cdFx0e1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZVxyXG5cdFx0e1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG4gICAgICAgXHJcbiAgICByZW5kZXIoKVxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICBjb25zdCBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICBcclxuICAgICAgICAvL2dldCBhbGwgb3V0Y29tZXMgLSB0aGVyZSdzIDIgdHlwZXMgLSBwZXIgcm93IGFuZCBidWxrLCBidWxrIGdvIGFzIGJ1dHRvbnMgb24gdG9wXHJcbiAgICAgICAgdmFyIG91dGNvbWVzID0gbWFueXdoby5tb2RlbC5nZXRPdXRjb21lcyh0aGlzLmNvbXBvbmVudElkLCAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgdG9wYnV0dG9ucyA9IFtdO1xyXG4gICAgICAgIHZhciByb3dCdXR0b25zID0gW107XHJcblxyXG4gICAgICAgIHZhciBkYmxDbGljayA6IGFueTtcclxuICAgICAgICB2YXIgY2xpY2sgOiBhbnk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9sb29wIG92ZXIgb3V0Y29tZXNcclxuICAgICAgICBmb3IodmFyIG9Qb3MgPSAwIDsgb1BvcyA8IG91dGNvbWVzLmxlbmd0aCA7IG9Qb3MrKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBvdXRjb21lID0gb3V0Y29tZXNbb1Bvc107XHJcbiAgICAgICAgICAgIGlmKG91dGNvbWUuaXNCdWxrQWN0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL3RvcCBidXR0b25cclxuICAgICAgICAgICAgICAgIHZhciBpY29uID0gb3V0Y29tZS5hdHRyaWJ1dGVzW1wiaWNvblwiXSB8fCBcIndyZW5jaFwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1cIiArIGljb24gKyBcIiBldC1idXR0b24tYmFyLWJ1dHRvblwiO1xyXG4gICAgICAgICAgICAgICAgdG9wYnV0dG9ucy5wdXNoKDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBvbkNsaWNrPXt0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcyl9IHRpdGxlPXtvdXRjb21lLmxhYmVsfT48L3NwYW4+KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9tdXN0IGJlIGEgcm93IGJ1dHRvbiwgaXQncyBhY3Rpb24gYXR0cmlidXRlIHdpbGwgdGVsbCBpZiBpdCBzaG91bGQgYmUgdGhlIERPVUJMRS1DTElDSyBldmVudFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoKG91dGNvbWUuYXR0cmlidXRlc1tcImFjdGlvblwiXSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQ0xJQ0tcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2sgPSBvdXRjb21lLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRPVUJMRS1DTElDS1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NhbnQgaGF2ZSBkb3VibGUgY2xpY2sgZm9yIG11bHRpIHNlbGVjdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGJsQ2xpY2sgPSBvdXRjb21lLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwibG9nLWluXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gXCJnbHlwaGljb24gZ2x5cGhpY29uLVwiICsgaWNvbiArIFwiIGV0LWJ1dHRvbi1iYXItYnV0dG9uXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BidXR0b25zLnB1c2goPHNwYW4gY2xhc3NOYW1lPXtjbGFzc05hbWV9IG9uQ2xpY2s9e3RoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKX0gdGl0bGU9e291dGNvbWUubGFiZWx9Pjwvc3Bhbj4pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0ID09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSA8c3BhbiBjbGFzc05hbWU9e2NsYXNzTmFtZX0gb25DbGljaz17dGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpfSB0aXRsZT17b3V0Y29tZS5sYWJlbH0+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93QnV0dG9ucy5wdXNoKGJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaCg8c3BhbiBjbGFzc05hbWU9e2NsYXNzTmFtZX0gb25DbGljaz17dGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIG91dGNvbWUuaWQpfSB0aXRsZT17b3V0Y29tZS5sYWJlbH0+PC9zcGFuPikgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbGFiZWwgOiBhbnk7XHJcbiAgICAgICAgdmFyIGxibCA6IGFueSA9IG51bGw7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9pZiB0aGUgY29tcG9uZW50IGhhcyBhIGxhYmVsIHRoZW4gcHV0IGl0IGluIHRoZSB0aXRsZSBiYXJcclxuICAgICAgICBpZihmbG93TW9kZWwubGFiZWwgJiYgZmxvd01vZGVsLmxhYmVsLmxlbmd0aD4wKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGJsID0gPHNwYW4+e2Zsb3dNb2RlbC5sYWJlbH08L3NwYW4+O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9jcmVhdGUgdGhlIHRpdGxlIGJhciBvYmplY3RcclxuICAgICAgICBsYWJlbCA9IDxkaXYgY2xhc3NOYW1lPVwiZXQtY2FwdGlvbi1kaXZcIj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImV0LWNhcHRpb25cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge2xibH1cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImV0LWJ1dHRvbi1iYXJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge3RvcGJ1dHRvbnN9XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICBcclxuXHJcblxyXG4gICAgICAgIHZhciBoZWFkZXJzID0gW107XHJcbiAgICAgICAgdmFyIHJvd3MgPSBbXTtcclxuICAgICAgICB2YXIgY29scyA6IGFueSA9IFtdO1xyXG4gICAgICAgIHZhciBjb2xEZWYgOiBhbnk7XHJcbiAgICAgICAgdmFyIHBvcyA9IDA7XHJcbiAgICAgICAgdmFyIHJvdyA6IGFueTtcclxuICAgICAgICB2YXIgcm93SWQgOiBhbnk7XHJcbiAgICAgICAgdmFyIHZhbHMgPSBbXTtcclxuXHJcbiAgICAgICAgLy9oZWFkZXIgcm93XHJcbiAgICAgICAgLy9hZGQgc3BhY2VyIGZvciBtdWx0aSBzZWxlY3QgaWYgbmVlZGVkXHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmlzTXVsdGlTZWxlY3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkZXJzLnB1c2goPHRkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRlci1jaGVja2JveFwiPjxpbnB1dCBjbGFzc05hbWU9XCJldC10YWJsZS1jaGVja2JveFwiIHR5cGU9XCJjaGVja2JveFwiIG9uQ2xpY2s9e3RoaXMudG9nZ2xlU2VsZWN0QWxsLmJpbmQodGhpcyl9PjwvaW5wdXQ+PC90ZD4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBhZGQgYnV0dG9uIHNwYWNlciBpZiB0aGVyZSBhcmUgYW55IHJvdyBidXR0b25zXHJcbiAgICAgICAgLy9pZiB0aGVyZSBhcmUgYnV0dG9ucyB0aGVuIGFkZCBibGFuayBoZWFkZXJcclxuICAgICAgICBpZihyb3dCdXR0b25zICYmIHJvd0J1dHRvbnMubGVuZ3RoID4gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaCg8dGQgY2xhc3NOYW1lPVwiZXQtdGFibGUtaGVhZGVyXCI+PC90ZD4pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9hZGQgZWFjaCBjb2x1bW5cclxuICAgICAgICBmb3IgKHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5jb2x1bW5zLmxlbmd0aCA7IHBvcysrKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgY29sTmFtZSA9IGZsb3dNb2RlbC5jb2x1bW5zW3Bvc10uZGV2ZWxvcGVyTmFtZTtcclxuICAgICAgICAgICAgdmFyIHNvcnRJY29uIDogYW55O1xyXG5cclxuICAgICAgICAgICAgLy9pcyB0aGlzIHRoZSBzb3J0ZWQgY29sdW1uIC0gaWYgc28gdGhlbiB3ZSBuZWVkIHRvIHNob3cgdGhlIHNvcnQgZGlyZWN0aW9uIGljb25cclxuICAgICAgICAgICAgaWYodGhpcy5zb3J0SXRlbSAmJiB0aGlzLnNvcnRJdGVtPT1jb2xOYW1lKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNvcnREaXJlY3Rpb24gPT0gXCJERVNDXCIpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEljb24gPSA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLWFycm93LWRvd25cIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEljb24gPSA8c3BhbiBjbGFzc05hbWU9XCJnbHlwaGljb24gZ2x5cGhpY29uLWFycm93LXVwXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc29ydEljb24gPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbHNbZmxvd01vZGVsLmNvbHVtbnNbcG9zXS5kZXZlbG9wZXJOYW1lXSA9IGZsb3dNb2RlbC5jb2x1bW5zW3Bvc107XHJcblxyXG4gICAgICAgICAgICAvL2VhY2ggaGVhZGVyIGhhcyBhIGNhcHRpb24gYW5kIGEgc29ydCBkaXJlY3Rpb24gaW5kaWNhdG9yXHJcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSA8dGggY2xhc3NOYW1lPVwiZXQtdGFibGUtaGVhZGVyXCIgZGF0YS1jb2x1bW4tbmFtZT17Y29sTmFtZX0gb25DbGljaz17dGhpcy5zb3J0LmJpbmQodGhpcyl9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7J2Zsb2F0JzogJ2xlZnQnfX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPntmbG93TW9kZWwuY29sdW1uc1twb3NdLmxhYmVsfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7J2Zsb2F0JzogJ3JpZ2h0J319PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c29ydEljb259XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGg+O1xyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaChoZWFkZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9ib2R5XHJcbiAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwub2JqZWN0RGF0YS5sZW5ndGggOyBwb3MrKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJvdz1mbG93TW9kZWwub2JqZWN0RGF0YVtwb3NdO1xyXG5cclxuICAgICAgICAgICAgcm93SWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShyb3cucHJvcGVydGllcywgdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHZhbHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIC8vaWYgdGhlIHJvd2lkIGlzIGluIHNlbGVjdGVkIHRoZW4gc2hvdyBjaGVja2VkXHJcbiAgICAgICAgICAgIHZhciBjaGVja2VkIDogYW55O1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9hZGQgZWl0aGVyIHRoZSBjaGVjayBib3hlcyBvciByb3cgYnV0dG9uc1xyXG4gICAgICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFscy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1jZWxsLWNoZWNrYm94XCI+PGlucHV0IGNsYXNzTmFtZT1cImV0LXRhYmxlLWNoZWNrYm94XCIgdHlwZT1cImNoZWNrYm94XCIgY2hlY2tlZD17Y2hlY2tlZH0gb25DbGljaz17dGhpcy50b2dnbGVTZWxlY3RJdGVtLmJpbmQodGhpcyl9PjwvaW5wdXQ+PC90ZD4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFscy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1jZWxsXCI+e3Jvd0J1dHRvbnN9PC90ZD4pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvcih2YXIgaVBvcyA9IDAgOyBpUG9zIDwgcm93LnByb3BlcnRpZXMubGVuZ3RoIDsgaVBvcysrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb2xEZWYgPSBjb2xzW3Jvdy5wcm9wZXJ0aWVzW2lQb3NdLmRldmVsb3Blck5hbWVdO1xyXG4gICAgICAgICAgICAgICAgaWYoIGNvbERlZiAmJiBjb2xEZWYuaXNEaXNwbGF5VmFsdWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFscy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1jZWxsXCI+e3Jvdy5wcm9wZXJ0aWVzW2lQb3NdLmNvbnRlbnRWYWx1ZX08L3RkPik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImV0LXRhYmxlLXJvd1wiO1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMgJiYgdGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpID49MClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lICs9IFwiIGV0LXRhYmxlLXJvdy1zZWxlY3RlZFwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBcIlwiO1xyXG4gICAgICAgICAgICBpZihmbG93TW9kZWwuaXNNdWx0aVNlbGVjdCA9PSB0cnVlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZT0gXCJDbGljayB0byBzZWxlY3QsIERvdWJsZS1DbGljayB0byBvcGVuXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aXRsZT0gXCJDbGljayB0byBzZWxlY3RcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2NyZWF0ZSByb3cgb2JqZWN0LCBub3RlIHdlIGFyZSBiaW5kaW5nIHNlbGVjdCB0byBpdHMgY2xpY2sgYW5kIHRoZSBkYmxjbGljayB2YWx1ZSAoYW4gb3V0Y29tZSBpZCkgdG8gZG91YmxlIGNsaWNrLiAgSXQgbWF5IGJlIG51bGwgYnV0IHRoYXRzIGZpbmVcclxuICAgICAgICAgICAgdmFyIHIgPSA8dHIgY2xhc3NOYW1lPXtjbGFzc05hbWV9IGRhdGEtcm93SWQ9e3Jvd0lkfSBkYXRhLW9iamVjdERhdGE9e3Jvd30gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuc2VsZWN0Um93LmJpbmQodGhpcyxjbGljayl9IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkRvdWJsZUNsaWNrPXt0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcyxkYmxDbGljayl9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPXt0aXRsZX0+e3ZhbHN9PC90cj47XHJcblxyXG4gICAgICAgICAgICByb3dzLnB1c2gocik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy9jb25zdHJ1Y3QgdGhlIHRhYmxlXHJcbiAgICAgICAgdmFyIHRhYmxlIDogYW55ID0gICA8ZGl2IGNsYXNzTmFtZT1cImV0LXRhYmxlLWRpdlwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzc05hbWU9XCJldC10YWJsZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3NOYW1lPVwiZXQtdGFibGUtaGVhZFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRlci1yb3dcIj57aGVhZGVyc308L3RyPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgY2xhc3NOYW1lPVwiZXQtdGFibGUtYm9keVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3Jvd3N9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwiZXRcIj5cclxuICAgICAgICAgICAgICAgICAgICB7bGFiZWx9XHJcbiAgICAgICAgICAgICAgICAgICAge3RhYmxlfVxyXG4gICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgIH1cclxuXHJcbiAgICBcclxuXHJcbiAgICAvL2dlbmVyaWMgaGFuZGxlciB0byB0cmlnZ2VyIGFuIG91dGNvbWVcclxuICAgIHRyaWdnZXJPdXRjb21lKG91dGNvbWVJZCA6IGFueSwgZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgLy9pZiBubyBvdXRjb21lIGlkIGp1c3QgcXVpdFxyXG4gICAgICAgIGlmKCFvdXRjb21lSWQgfHwgb3V0Y29tZUlkLmxlbmd0aDwxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcm93SWQgOiBhbnk7XHJcbiAgICAgICAgY29uc3QgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciByb3dLZXlGaWVsZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKTtcclxuXHJcbiAgICAgICAgdmFyIG5ld1N0YXRlIDogYW55O1xyXG4gICAgICAgIHZhciBvYmplY3REYXRhQXJyYXkgPSBbXTtcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YSA6IGFueTtcclxuXHJcbiAgICAgICAgZm9yKHZhciBrZXkgaW4gdGhpcy5zZWxlY3RlZEl0ZW1zKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YT10aGlzLmdldE9iamVjdERhdGFCeUtleShmbG93TW9kZWwub2JqZWN0RGF0YSwgcm93S2V5RmllbGQsIHRoaXMuc2VsZWN0ZWRJdGVtc1trZXldKTtcclxuICAgICAgICAgICAgLy9jbG9uZSBkYXRhXHJcbiAgICAgICAgICAgIG9iamVjdERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iamVjdERhdGEpKTtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YS5pc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YUFycmF5LnB1c2gob2JqZWN0RGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICBcclxuICAgICAgICBuZXdTdGF0ZSA9IHtcclxuXHRcdFx0b2JqZWN0RGF0YTogb2JqZWN0RGF0YUFycmF5XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRtYW55d2hvLnN0YXRlLnNldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCBuZXdTdGF0ZSwgdGhpcy5mbG93S2V5LCB0cnVlKTtcclxuXHJcbiAgICAgICAgaWYob2JqZWN0RGF0YUFycmF5ICYmIG9iamVjdERhdGFBcnJheS5sZW5ndGggPiAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYob3V0Y29tZUlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZShvdXRjb21lSWQsIHRoaXMuZmxvd0tleSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYob3V0Y29tZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYW55d2hvLmNvbXBvbmVudC5vbk91dGNvbWUob3V0Y29tZSwgbnVsbCAsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNvcnQoZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgaWYodGhpcy5zb3J0RGlyZWN0aW9uICYmIHRoaXMuc29ydERpcmVjdGlvbiA9PSBcIkFTQ1wiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9uPVwiREVTQ1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb249XCJBU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZVNlbGVjdEFsbChldmVudCA6IGFueSlcclxuICAgIHtcclxuICAgICAgICBpZihldmVudC5jdXJyZW50VGFyZ2V0LmNoZWNrZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL2NoZWNrIGFsbFxyXG4gICAgICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5vYmplY3REYXRhLmxlbmd0aCA7IHBvcysrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm93PWZsb3dNb2RlbC5vYmplY3REYXRhW3Bvc107XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJvd0lkID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkocm93LnByb3BlcnRpZXMsIHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKSkuY29udGVudFZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRJdGVtcy5pbmRleE9mKHJvd0lkKSA8IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvL2Egcm93IHdhcyBzZWxlY3RlZCwgc3RvcmUgaXQncyBpZCBhdCBjb21wb25lbnQgbGV2ZWwgYW5kIHJlZHJhd1xyXG4gICAgc2VsZWN0Um93KG91dGNvbWVJZCA6IGFueSwgZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKGZsb3dNb2RlbC5pc011bHRpU2VsZWN0ID09IGZhbHNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9vbmx5IG9uZSBjYW4gYmUgc2VsZWN0ZWRcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKSA8IDApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMucHVzaChldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyT3V0Y29tZShvdXRjb21lSWQsIGV2ZW50KTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlU2VsZWN0SXRlbShldmVudCA6IGFueSlcclxuICAgIHtcclxuICAgICAgICB2YXIgcm93SWQ9ZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSB8fCBldmVudC5jdXJyZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKTtcclxuICAgICAgICBpZih0aGlzLnNlbGVjdGVkSXRlbXMuaW5kZXhPZihyb3dJZCkgPCAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW1zLnB1c2gocm93SWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgaWR4ID0gdGhpcy5zZWxlY3RlZEl0ZW1zLmluZGV4T2Yocm93SWQpO1xyXG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkSXRlbXMuc3BsaWNlKGlkeCwxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy90aGlzLnNvcnRJdGVtID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY29sdW1uLW5hbWUnKTtcclxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vaGVscGVyIHRvIGdldCBhIHNwZWNpZmljIG9iamVjdCBkYXRhIGl0ZW0gZ2l2ZW4gYSBmaWVsZD12YWx1ZSBjcml0ZXJpYSBcclxuICAgIGdldE9iamVjdERhdGFCeUtleShvYmplY3REYXRhIDogYW55LCBmaWVsZE5hbWUgOiBzdHJpbmcsIHZhbHVlIDogc3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBvZCA6IGFueTtcclxuICAgICAgICB2YXIgdmFsIDogYW55O1xyXG4gICAgICAgIC8vbG9vcCBvdmVyIGRhdGEgaXRlbXNcclxuICAgICAgICBmb3IodmFyIHBvcyA9IDAgOyBwb3MgPCBvYmplY3REYXRhLmxlbmd0aDsgcG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvZCA9IG9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgdmFsID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkob2QucHJvcGVydGllcywgZmllbGROYW1lKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIGlmKHZhbD09dmFsdWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcblxyXG4gICAgXHJcbn1cclxuXHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdFbmhhbmNlZFRhYmxlJywgRW5oYW5jZWRUYWJsZSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBFbmhhbmNlZFRhYmxlO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9FbmhhbmNlZFRhYmxlLnRzeCIsIm1vZHVsZS5leHBvcnRzID0gUmVhY3Q7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJSZWFjdFwiXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=