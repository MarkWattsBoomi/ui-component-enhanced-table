!function(t){function e(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var o in t)e.hasOwnProperty(o)||(e[o]=t[o])}(o(1))},function(t,e,o){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=o(2);o(3);var a=function(t){function e(e){var o=t.call(this,e)||this;o.componentId="",o.flowKey="",o.attributes={},o.selectedItem=null,o.sortItem=null,o.sortDirection=null,o.text="",o.componentId=e.id,o.flowKey=e.flowKey;var n=manywho.model.getComponent(o.props.id,o.props.flowKey);if(n.attributes)for(var r in n.attributes)o.attributes[r]=n.attributes[r];return o}return n(e,t),e.prototype.componentDidMount=function(){this.forceUpdate()},e.prototype.componentDidUpdate=function(){},e.prototype.getAttribute=function(t){return this.attributes[t]?this.attributes[t]:null},e.prototype.render=function(){for(var t,e=manywho.model.getComponent(this.componentId,this.flowKey),o=(manywho.state.getComponent(this.componentId,this.flowKey),manywho.model.getOutcomes(this.componentId,this.flowKey)),n=[],a=[],i=0;i<o.length;i++){var l=o[i];if(l.isBulkAction){var s=l.attributes.icon||"wrench",c="glyphicon glyphicon-"+s+" et-button-bar-button";n.push(r.createElement("span",{className:c,onClick:this.triggerOutcome.bind(this),title:l.label}))}else switch(l.attributes.action){case"CLICK":l.id;break;case"DOUBLE-CLICK":t=l.id;break;default:var s=l.attributes.icon||"wrench",c="glyphicon glyphicon-"+s+" et-button-bar-button",u=r.createElement("span",{className:c,onClick:this.triggerOutcome.bind(this,l.id),title:l.label});a.push(u)}}var m,p=null;e.label&&e.label.length>0&&(p=r.createElement("span",null,e.label)),m=r.createElement("div",{className:"et-caption-div"},r.createElement("div",{className:"et-caption"},p),r.createElement("div",{className:"et-button-bar"},n));var h,d,b,f=[],y=[],g=[],w=0,v=[];for(a&&a.length>0&&f.push(r.createElement("td",{className:"et-table-header"})),w=0;w<e.columns.length;w++){var E,O=e.columns[w].developerName;E=this.sortItem&&this.sortItem==O?"DESC"==this.sortDirection?r.createElement("span",{className:"glyphicon glyphicon-arrow-down"}):r.createElement("span",{className:"glyphicon glyphicon-arrow-up"}):null,g[e.columns[w].developerName]=e.columns[w];var D=r.createElement("th",{className:"et-table-header","data-column-name":O,onClick:this.sort.bind(this)},r.createElement("div",null,r.createElement("div",{style:{float:"left"}},r.createElement("span",null,e.columns[w].label)),r.createElement("div",{style:{float:"right"}},E)));f.push(D)}for(w=0;w<e.objectData.length;w++){d=e.objectData[w],b=manywho.utils.getObjectDataProperty(d.properties,this.getAttribute("Row Key")).contentValue,v=[],v.push(r.createElement("td",{className:"et-table-cell"},a));for(var I=0;I<d.properties.length;I++)(h=g[d.properties[I].developerName])&&h.isDisplayValue&&v.push(r.createElement("td",{className:"et-table-cell"},d.properties[I].contentValue));var c="et-table-row";this.selectedItem&&this.selectedItem==b&&(c+=" et-table-row-selected");var N=r.createElement("tr",{className:c,"data-rowId":b,"data-objectData":d,onClick:this.selectRow.bind(this),onDoubleClick:this.triggerOutcome.bind(this,t)},v);y.push(N)}var C=r.createElement("div",{className:"et-table-div"},r.createElement("table",{className:"et-table"},r.createElement("thead",{className:"et-table-head"},r.createElement("tr",{className:"et-table-header-row"},f)),r.createElement("tbody",{className:"et-table-body"},y)));return r.createElement("div",{className:"et"},m,C)},e.prototype.selectRow=function(t){this.selectedItem=t.currentTarget.getAttribute("data-rowId"),this.forceUpdate()},e.prototype.doubleClickRow=function(t){var e=t.currentTarget.getAttribute("data-rowId")||t.currentTarget.parentElement.parentElement.getAttribute("data-rowId"),o=manywho.model.getComponent(this.componentId,this.flowKey),n=this.getAttribute("Row Key"),r=this.getObjectDataByKey(o.objectData,n,e);r=JSON.parse(JSON.stringify(r)),r.isSelected=!0;var a={objectData:[r]};if(manywho.state.setComponent(this.componentId,a,this.flowKey,!0),r){var i=this.getAttribute("Double Click Outcome Id");if(i){var l=manywho.model.getOutcome(i,this.flowKey);l&&manywho.component.onOutcome(l,null,this.flowKey)}}this.forceUpdate()},e.prototype.triggerOutcome=function(t,e){var o=e.currentTarget.getAttribute("data-rowId")||e.currentTarget.parentElement.parentElement.getAttribute("data-rowId"),n=manywho.model.getComponent(this.componentId,this.flowKey),r=this.getAttribute("Row Key"),a=this.getObjectDataByKey(n.objectData,r,o);a=JSON.parse(JSON.stringify(a)),a.isSelected=!0;var i={objectData:[a]};if(manywho.state.setComponent(this.componentId,i,this.flowKey,!0),a&&t){var l=manywho.model.getOutcome(t,this.flowKey);l&&manywho.component.onOutcome(l,null,this.flowKey)}this.forceUpdate()},e.prototype.sort=function(t){this.sortItem=t.currentTarget.getAttribute("data-column-name"),this.sortDirection&&"ASC"==this.sortDirection?this.sortDirection="DESC":this.sortDirection="ASC",this.forceUpdate()},e.prototype.getObjectDataByKey=function(t,e,o){for(var n,r=0;r<t.length;r++)if(n=t[r],manywho.utils.getObjectDataProperty(n.properties,e).contentValue==o)return n;return null},e}(r.Component);manywho.component.register("EnhancedTable",a),e.default=a},function(t,e){t.exports=React},function(t,e){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vRW5oYW5jZWRUYWJsZS5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgZTc2NjFlMDM1NmJjMjE2Mzc3MGIiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzeCIsIndlYnBhY2s6Ly8vLi9zcmMvRW5oYW5jZWRUYWJsZS50c3giLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUmVhY3RcIiJdLCJuYW1lcyI6WyJtb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSIsImdldCIsIm4iLCJfX2VzTW9kdWxlIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwidmFsdWUiLCJfX2V4dGVuZHMiLCJ0aGlzIiwiZXh0ZW5kU3RhdGljcyIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJiIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIlJlYWN0IiwiRW5oYW5jZWRUYWJsZSIsIl9zdXBlciIsInByb3BzIiwiX3RoaXMiLCJjb21wb25lbnRJZCIsImZsb3dLZXkiLCJhdHRyaWJ1dGVzIiwic2VsZWN0ZWRJdGVtIiwic29ydEl0ZW0iLCJzb3J0RGlyZWN0aW9uIiwidGV4dCIsImlkIiwiZmxvd01vZGVsIiwibWFueXdobyIsIm1vZGVsIiwiZ2V0Q29tcG9uZW50Iiwia2V5IiwiY29tcG9uZW50RGlkTW91bnQiLCJmb3JjZVVwZGF0ZSIsImNvbXBvbmVudERpZFVwZGF0ZSIsImdldEF0dHJpYnV0ZSIsImF0dHJpYnV0ZU5hbWUiLCJyZW5kZXIiLCJkYmxDbGljayIsIm91dGNvbWVzIiwic3RhdGUiLCJnZXRPdXRjb21lcyIsInRvcGJ1dHRvbnMiLCJyb3dCdXR0b25zIiwib1BvcyIsImxlbmd0aCIsIm91dGNvbWUiLCJpc0J1bGtBY3Rpb24iLCJpY29uIiwiY2xhc3NOYW1lIiwicHVzaCIsImNyZWF0ZUVsZW1lbnQiLCJvbkNsaWNrIiwidHJpZ2dlck91dGNvbWUiLCJiaW5kIiwidGl0bGUiLCJsYWJlbCIsImJ1dHRvbiIsImxibCIsImNvbERlZiIsInJvdyIsInJvd0lkIiwiaGVhZGVycyIsInJvd3MiLCJjb2xzIiwicG9zIiwidmFscyIsImNvbHVtbnMiLCJzb3J0SWNvbiIsImNvbE5hbWUiLCJkZXZlbG9wZXJOYW1lIiwiaGVhZGVyIiwiZGF0YS1jb2x1bW4tbmFtZSIsInNvcnQiLCJzdHlsZSIsImZsb2F0Iiwib2JqZWN0RGF0YSIsInV0aWxzIiwiZ2V0T2JqZWN0RGF0YVByb3BlcnR5IiwicHJvcGVydGllcyIsImNvbnRlbnRWYWx1ZSIsImlQb3MiLCJpc0Rpc3BsYXlWYWx1ZSIsInIiLCJkYXRhLXJvd0lkIiwiZGF0YS1vYmplY3REYXRhIiwic2VsZWN0Um93Iiwib25Eb3VibGVDbGljayIsInRhYmxlIiwiZXZlbnQiLCJjdXJyZW50VGFyZ2V0IiwiZG91YmxlQ2xpY2tSb3ciLCJwYXJlbnRFbGVtZW50Iiwicm93S2V5RmllbGQiLCJnZXRPYmplY3REYXRhQnlLZXkiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJpc1NlbGVjdGVkIiwibmV3U3RhdGUiLCJzZXRDb21wb25lbnQiLCJkb3VibGVDbGlja091dGNvbWVJZCIsImdldE91dGNvbWUiLCJjb21wb25lbnQiLCJvbk91dGNvbWUiLCJvdXRjb21lSWQiLCJmaWVsZE5hbWUiLCJvZCIsIkNvbXBvbmVudCIsInJlZ2lzdGVyIiwiZGVmYXVsdCJdLCJtYXBwaW5ncyI6IkNBQVMsU0FBVUEsR0NJbkIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFFLE9BR0EsSUFBQUMsR0FBQUYsRUFB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ZixLQUFLNEIsZUFHVGxCLEVBQUFoQixVQUFBMEUsS0FBQSxTQUFLZ0IsR0FFRHBGLEtBQUtrQixTQUFXa0UsRUFBTUMsY0FBY3ZELGFBQWEsb0JBQzlDOUIsS0FBS21CLGVBQXVDLE9BQXRCbkIsS0FBS21CLGNBRTFCbkIsS0FBS21CLGNBQWMsT0FJbkJuQixLQUFLbUIsY0FBYyxNQUV2Qm5CLEtBQUs0QixlQUdUbEIsRUFBQWhCLFVBQUErRixtQkFBQSxTQUFtQmxCLEVBQWtCOEIsRUFBb0J2RyxHQUtyRCxJQUFJLEdBSEF3RyxHQUdJMUMsRUFBTSxFQUFJQSxFQUFNVyxFQUFXL0IsT0FBUW9CLElBSXZDLEdBRkEwQyxFQUFLL0IsRUFBV1gsR0FDVnJDLFFBQVFpRCxNQUFNQyxzQkFBc0I2QixFQUFHNUIsV0FBWTJCLEdBQVcxQixjQUM1RDdFLEVBRUosTUFBT3dHLEVBR2YsT0FBTyxPQUdmNUYsR0E3VTRCRCxFQUFNOEYsVUErVWxDaEYsU0FBUTJFLFVBQVVNLFNBQVMsZ0JBQWlCOUYsR0FFNUNwQyxFQUFBbUksUUFBZS9GLEdIcEJULFNBQVVuQyxFQUFRRCxHSW5VeEJDLEVBQUFELFFBQUFtQyxPSnlVTSxTQUFVbEMsRUFBUUQiLCJmaWxlIjoiRW5oYW5jZWRUYWJsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0aTogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9XG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4vKioqKioqLyBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbi8qKioqKiovIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbi8qKioqKiovIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbi8qKioqKiovIFx0XHRcdH0pO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuLyoqKioqKi8gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuLyoqKioqKi8gXHRcdHJldHVybiBnZXR0ZXI7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cclxuZnVuY3Rpb24gX19leHBvcnQobSkge1xyXG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAoIWV4cG9ydHMuaGFzT3duUHJvcGVydHkocCkpIGV4cG9ydHNbcF0gPSBtW3BdO1xyXG59XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuX19leHBvcnQoX193ZWJwYWNrX3JlcXVpcmVfXygxKSk7XHJcblxuXG4vKioqLyB9KSxcbi8qIDEgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcclxuX193ZWJwYWNrX3JlcXVpcmVfXygzKTtcclxudmFyIEVuaGFuY2VkVGFibGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRW5oYW5jZWRUYWJsZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEVuaGFuY2VkVGFibGUocHJvcHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jb21wb25lbnRJZCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIF90aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7XHJcbiAgICAgICAgX3RoaXMuc29ydEl0ZW0gPSBudWxsO1xyXG4gICAgICAgIF90aGlzLnNvcnREaXJlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgIF90aGlzLnRleHQgPSBcIlwiO1xyXG4gICAgICAgIF90aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IHByb3BzLmZsb3dLZXk7XHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KF90aGlzLnByb3BzLmlkLCBfdGhpcy5wcm9wcy5mbG93S2V5KTtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuZ2V0QXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZU5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZU5hbWVdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIC8vZ2V0IGFsbCBvdXRjb21lcyAtIHRoZXJlJ3MgMiB0eXBlcyAtIHBlciByb3cgYW5kIGJ1bGssIGJ1bGsgZ28gYXMgYnV0dG9ucyBvbiB0b3BcclxuICAgICAgICB2YXIgb3V0Y29tZXMgPSBtYW55d2hvLm1vZGVsLmdldE91dGNvbWVzKHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHRvcGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93QnV0dG9ucyA9IFtdO1xyXG4gICAgICAgIHZhciBjbGljaztcclxuICAgICAgICB2YXIgZGJsQ2xpY2s7XHJcbiAgICAgICAgLy9sb29wIG92ZXIgb3V0Y29tZXNcclxuICAgICAgICBmb3IgKHZhciBvUG9zID0gMDsgb1BvcyA8IG91dGNvbWVzLmxlbmd0aDsgb1BvcysrKSB7XHJcbiAgICAgICAgICAgIHZhciBvdXRjb21lID0gb3V0Y29tZXNbb1Bvc107XHJcbiAgICAgICAgICAgIGlmIChvdXRjb21lLmlzQnVsa0FjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy90b3AgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lLCBvbkNsaWNrOiB0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcyksIHRpdGxlOiBvdXRjb21lLmxhYmVsIH0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vbXVzdCBiZSBhIHJvdyBidXR0b24sIGl0J3MgYWN0aW9uIGF0dHJpYnV0ZSB3aWxsIHRlbGwgdXMgd2hhdCBpdCBzaG91bGQgYmUgQlVUVE9OLCBDTElDSywgRE9VQkxFLUNMSUNLXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG91dGNvbWUuYXR0cmlidXRlc1tcImFjdGlvblwiXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJDTElDS1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RyaWdnZXIgb24gZXZlcnkgY2xpY2tcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2sgPSBvdXRjb21lLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiRE9VQkxFLUNMSUNLXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRibENsaWNrID0gb3V0Y29tZS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBjbGFzc05hbWUsIG9uQ2xpY2s6IHRoaXMudHJpZ2dlck91dGNvbWUuYmluZCh0aGlzLCBvdXRjb21lLmlkKSwgdGl0bGU6IG91dGNvbWUubGFiZWwgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd0J1dHRvbnMucHVzaChidXR0b24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbGFiZWw7XHJcbiAgICAgICAgdmFyIGxibCA9IG51bGw7XHJcbiAgICAgICAgaWYgKGZsb3dNb2RlbC5sYWJlbCAmJiBmbG93TW9kZWwubGFiZWwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBsYmwgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCBudWxsLCBmbG93TW9kZWwubGFiZWwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsYWJlbCA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXQtY2FwdGlvbi1kaXZcIiB9LFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LWNhcHRpb25cIiB9LCBsYmwpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LWJ1dHRvbi1iYXJcIiB9LCB0b3BidXR0b25zKSk7XHJcbiAgICAgICAgdmFyIGhlYWRlcnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93cyA9IFtdO1xyXG4gICAgICAgIHZhciBjb2xzID0gW107XHJcbiAgICAgICAgdmFyIGNvbERlZjtcclxuICAgICAgICB2YXIgcG9zID0gMDtcclxuICAgICAgICB2YXIgcm93O1xyXG4gICAgICAgIHZhciByb3dJZDtcclxuICAgICAgICB2YXIgdmFscyA9IFtdO1xyXG4gICAgICAgIC8vaGVhZGVyIHJvd1xyXG4gICAgICAgIC8vIGFkZCBidXR0b24gc3BhY2VyIGlmIG5lZWRlZFxyXG4gICAgICAgIC8vaWYgdGhlcmUgYXJlIGJ1dHRvbnMgdGhlbiBhZGQgYmxhbmsgaGVhZGVyXHJcbiAgICAgICAgaWYgKHJvd0J1dHRvbnMgJiYgcm93QnV0dG9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZGVyXCIgfSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHBvcyA9IDA7IHBvcyA8IGZsb3dNb2RlbC5jb2x1bW5zLmxlbmd0aDsgcG9zKyspIHtcclxuICAgICAgICAgICAgdmFyIGNvbE5hbWUgPSBmbG93TW9kZWwuY29sdW1uc1twb3NdLmRldmVsb3Blck5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzb3J0SWNvbjtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc29ydEl0ZW0gJiYgdGhpcy5zb3J0SXRlbSA9PSBjb2xOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zb3J0RGlyZWN0aW9uID09IFwiREVTQ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc29ydEljb24gPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJnbHlwaGljb24gZ2x5cGhpY29uLWFycm93LWRvd25cIiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvcnRJY29uID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1hcnJvdy11cFwiIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ydEljb24gPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbHNbZmxvd01vZGVsLmNvbHVtbnNbcG9zXS5kZXZlbG9wZXJOYW1lXSA9IGZsb3dNb2RlbC5jb2x1bW5zW3Bvc107XHJcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGhcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZGVyXCIsIFwiZGF0YS1jb2x1bW4tbmFtZVwiOiBjb2xOYW1lLCBvbkNsaWNrOiB0aGlzLnNvcnQuYmluZCh0aGlzKSB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBzdHlsZTogeyAnZmxvYXQnOiAnbGVmdCcgfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwic3BhblwiLCBudWxsLCBmbG93TW9kZWwuY29sdW1uc1twb3NdLmxhYmVsKSksXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IHN0eWxlOiB7ICdmbG9hdCc6ICdyaWdodCcgfSB9LCBzb3J0SWNvbikpKTtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKGhlYWRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vYm9keVxyXG4gICAgICAgIGZvciAocG9zID0gMDsgcG9zIDwgZmxvd01vZGVsLm9iamVjdERhdGEubGVuZ3RoOyBwb3MrKykge1xyXG4gICAgICAgICAgICByb3cgPSBmbG93TW9kZWwub2JqZWN0RGF0YVtwb3NdO1xyXG4gICAgICAgICAgICByb3dJZCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KHJvdy5wcm9wZXJ0aWVzLCB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIikpLmNvbnRlbnRWYWx1ZTtcclxuICAgICAgICAgICAgdmFscyA9IFtdO1xyXG4gICAgICAgICAgICB2YWxzLnB1c2goUmVhY3QuY3JlYXRlRWxlbWVudChcInRkXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWNlbGxcIiB9LCByb3dCdXR0b25zKSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGlQb3MgPSAwOyBpUG9zIDwgcm93LnByb3BlcnRpZXMubGVuZ3RoOyBpUG9zKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbERlZiA9IGNvbHNbcm93LnByb3BlcnRpZXNbaVBvc10uZGV2ZWxvcGVyTmFtZV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sRGVmICYmIGNvbERlZi5pc0Rpc3BsYXlWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHMucHVzaChSZWFjdC5jcmVhdGVFbGVtZW50KFwidGRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtY2VsbFwiIH0sIHJvdy5wcm9wZXJ0aWVzW2lQb3NdLmNvbnRlbnRWYWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImV0LXRhYmxlLXJvd1wiO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RlZEl0ZW0gJiYgdGhpcy5zZWxlY3RlZEl0ZW0gPT0gcm93SWQpIHtcclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZSArPSBcIiBldC10YWJsZS1yb3ctc2VsZWN0ZWRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgciA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0clwiLCB7IGNsYXNzTmFtZTogY2xhc3NOYW1lLCBcImRhdGEtcm93SWRcIjogcm93SWQsIFwiZGF0YS1vYmplY3REYXRhXCI6IHJvdywgb25DbGljazogdGhpcy5zZWxlY3RSb3cuYmluZCh0aGlzKSwgb25Eb3VibGVDbGljazogdGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMsIGRibENsaWNrKSB9LCB2YWxzKTtcclxuICAgICAgICAgICAgLy9yLnNldEF0dHJpYnV0ZSgncm93SWQnLHJvd0lkKTtcclxuICAgICAgICAgICAgcm93cy5wdXNoKHIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdGFibGUgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWRpdlwiIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJ0YWJsZVwiLCB7IGNsYXNzTmFtZTogXCJldC10YWJsZVwiIH0sXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGhlYWRcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtaGVhZFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInRyXCIsIHsgY2xhc3NOYW1lOiBcImV0LXRhYmxlLWhlYWRlci1yb3dcIiB9LCBoZWFkZXJzKSksXHJcbiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwidGJvZHlcIiwgeyBjbGFzc05hbWU6IFwiZXQtdGFibGUtYm9keVwiIH0sIHJvd3MpKSk7XHJcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZXRcIiB9LFxyXG4gICAgICAgICAgICBsYWJlbCxcclxuICAgICAgICAgICAgdGFibGUpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnNlbGVjdFJvdyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtID0gZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKTtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgRW5oYW5jZWRUYWJsZS5wcm90b3R5cGUuZG91YmxlQ2xpY2tSb3cgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgcm93SWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpIHx8IGV2ZW50LmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpO1xyXG4gICAgICAgIDtcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgcm93S2V5RmllbGQgPSB0aGlzLmdldEF0dHJpYnV0ZShcIlJvdyBLZXlcIik7XHJcbiAgICAgICAgdmFyIG9iamVjdERhdGEgPSB0aGlzLmdldE9iamVjdERhdGFCeUtleShmbG93TW9kZWwub2JqZWN0RGF0YSwgcm93S2V5RmllbGQsIHJvd0lkKTtcclxuICAgICAgICAvL2Nsb25lIGRhdGFcclxuICAgICAgICBvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3REYXRhKSk7XHJcbiAgICAgICAgb2JqZWN0RGF0YS5pc1NlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICB2YXIgbmV3U3RhdGUgPSB7XHJcbiAgICAgICAgICAgIG9iamVjdERhdGE6IFtvYmplY3REYXRhXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbWFueXdoby5zdGF0ZS5zZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgbmV3U3RhdGUsIHRoaXMuZmxvd0tleSwgdHJ1ZSk7XHJcbiAgICAgICAgaWYgKG9iamVjdERhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGRvdWJsZUNsaWNrT3V0Y29tZUlkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJEb3VibGUgQ2xpY2sgT3V0Y29tZSBJZFwiKTtcclxuICAgICAgICAgICAgaWYgKGRvdWJsZUNsaWNrT3V0Y29tZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZShkb3VibGVDbGlja091dGNvbWVJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAgICAgICAgIGlmIChvdXRjb21lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFueXdoby5jb21wb25lbnQub25PdXRjb21lKG91dGNvbWUsIG51bGwsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEVuaGFuY2VkVGFibGUucHJvdG90eXBlLnRyaWdnZXJPdXRjb21lID0gZnVuY3Rpb24gKG91dGNvbWVJZCwgZXZlbnQpIHtcclxuICAgICAgICB2YXIgcm93SWQgPSBldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpIHx8IGV2ZW50LmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpO1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciByb3dLZXlGaWVsZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiUm93IEtleVwiKTtcclxuICAgICAgICB2YXIgb2JqZWN0RGF0YSA9IHRoaXMuZ2V0T2JqZWN0RGF0YUJ5S2V5KGZsb3dNb2RlbC5vYmplY3REYXRhLCByb3dLZXlGaWVsZCwgcm93SWQpO1xyXG4gICAgICAgIC8vY2xvbmUgZGF0YVxyXG4gICAgICAgIG9iamVjdERhdGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iamVjdERhdGEpKTtcclxuICAgICAgICBvYmplY3REYXRhLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgIHZhciBuZXdTdGF0ZSA9IHtcclxuICAgICAgICAgICAgb2JqZWN0RGF0YTogW29iamVjdERhdGFdXHJcbiAgICAgICAgfTtcclxuICAgICAgICBtYW55d2hvLnN0YXRlLnNldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCBuZXdTdGF0ZSwgdGhpcy5mbG93S2V5LCB0cnVlKTtcclxuICAgICAgICBpZiAob2JqZWN0RGF0YSkge1xyXG4gICAgICAgICAgICBpZiAob3V0Y29tZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZShvdXRjb21lSWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICBpZiAob3V0Y29tZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hbnl3aG8uY29tcG9uZW50Lm9uT3V0Y29tZShvdXRjb21lLCBudWxsLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5zb3J0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgaWYgKHRoaXMuc29ydERpcmVjdGlvbiAmJiB0aGlzLnNvcnREaXJlY3Rpb24gPT0gXCJBU0NcIikge1xyXG4gICAgICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb24gPSBcIkRFU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydERpcmVjdGlvbiA9IFwiQVNDXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBFbmhhbmNlZFRhYmxlLnByb3RvdHlwZS5nZXRPYmplY3REYXRhQnlLZXkgPSBmdW5jdGlvbiAob2JqZWN0RGF0YSwgZmllbGROYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciBvZDtcclxuICAgICAgICB2YXIgdmFsO1xyXG4gICAgICAgIC8vbG9vcCBvdmVyIGRhdGEgaXRlbXNcclxuICAgICAgICBmb3IgKHZhciBwb3MgPSAwOyBwb3MgPCBvYmplY3REYXRhLmxlbmd0aDsgcG9zKyspIHtcclxuICAgICAgICAgICAgb2QgPSBvYmplY3REYXRhW3Bvc107XHJcbiAgICAgICAgICAgIHZhbCA9IG1hbnl3aG8udXRpbHMuZ2V0T2JqZWN0RGF0YVByb3BlcnR5KG9kLnByb3BlcnRpZXMsIGZpZWxkTmFtZSkuY29udGVudFZhbHVlO1xyXG4gICAgICAgICAgICBpZiAodmFsID09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb2Q7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEVuaGFuY2VkVGFibGU7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdFbmhhbmNlZFRhYmxlJywgRW5oYW5jZWRUYWJsZSk7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IEVuaGFuY2VkVGFibGU7XHJcblxuXG4vKioqLyB9KSxcbi8qIDIgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdDtcblxuLyoqKi8gfSksXG4vKiAzICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cbi8qKiovIH0pXG4vKioqKioqLyBdKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gRW5oYW5jZWRUYWJsZS5qcyIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIGU3NjYxZTAzNTZiYzIxNjM3NzBiIiwiZXhwb3J0ICogZnJvbSAnLi9FbmhhbmNlZFRhYmxlJztcblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL2luZGV4LnRzeCIsIlxyXG5kZWNsYXJlIHZhciBtYW55d2hvOiBhbnk7XHJcblxyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCAnLi9FbmhhbmNlZFRhYmxlLmNzcyc7XHJcblxyXG5jbGFzcyBFbmhhbmNlZFRhYmxlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiBcclxueyAgIFxyXG4gICAgY29tcG9uZW50SWQ6IHN0cmluZyA9IFwiXCI7XHJcbiAgICBmbG93S2V5OiBzdHJpbmcgPVwiXCI7ICAgIFxyXG4gICAgYXR0cmlidXRlcyA6IGFueSA9IHt9O1xyXG4gICAgc2VsZWN0ZWRJdGVtOiBhbnkgPSBudWxsO1xyXG4gICAgc29ydEl0ZW0gOiBhbnkgPSBudWxsO1xyXG4gICAgc29ydERpcmVjdGlvbiA6IGFueSA9IG51bGw7XHJcblxyXG4gICAgdGV4dCA6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvcHMgOiBhbnkpXHJcblx0e1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuXHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcblx0XHR2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5wcm9wcy5pZCwgICB0aGlzLnByb3BzLmZsb3dLZXkpO1xyXG5cdFx0aWYoZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHR7XHJcblx0XHRcdGZvcih2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0dGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSBcclxuICAgIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKClcclxuICAgIHtcclxuXHJcbiAgICB9XHJcblxyXG5cdGdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lIDogc3RyaW5nKVxyXG5cdHtcclxuXHRcdGlmKHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSlcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuICAgICAgIFxyXG4gICAgcmVuZGVyKClcclxuICAgIHtcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgXHJcbiAgICAgICAgLy9nZXQgYWxsIG91dGNvbWVzIC0gdGhlcmUncyAyIHR5cGVzIC0gcGVyIHJvdyBhbmQgYnVsaywgYnVsayBnbyBhcyBidXR0b25zIG9uIHRvcFxyXG4gICAgICAgIHZhciBvdXRjb21lcyA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZXModGhpcy5jb21wb25lbnRJZCwgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHRvcGJ1dHRvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93QnV0dG9ucyA9IFtdO1xyXG5cclxuICAgICAgICB2YXIgY2xpY2sgOiBhbnk7XHJcbiAgICAgICAgdmFyIGRibENsaWNrIDogYW55O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vbG9vcCBvdmVyIG91dGNvbWVzXHJcbiAgICAgICAgZm9yKHZhciBvUG9zID0gMCA7IG9Qb3MgPCBvdXRjb21lcy5sZW5ndGggOyBvUG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG91dGNvbWVzW29Qb3NdO1xyXG4gICAgICAgICAgICBpZihvdXRjb21lLmlzQnVsa0FjdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy90b3AgYnV0dG9uXHJcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG91dGNvbWUuYXR0cmlidXRlc1tcImljb25cIl0gfHwgXCJ3cmVuY2hcIjtcclxuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgIHRvcGJ1dHRvbnMucHVzaCg8c3BhbiBjbGFzc05hbWU9e2NsYXNzTmFtZX0gb25DbGljaz17dGhpcy50cmlnZ2VyT3V0Y29tZS5iaW5kKHRoaXMpfSB0aXRsZT17b3V0Y29tZS5sYWJlbH0+PC9zcGFuPilcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vbXVzdCBiZSBhIHJvdyBidXR0b24sIGl0J3MgYWN0aW9uIGF0dHJpYnV0ZSB3aWxsIHRlbGwgdXMgd2hhdCBpdCBzaG91bGQgYmUgQlVUVE9OLCBDTElDSywgRE9VQkxFLUNMSUNLXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2gob3V0Y29tZS5hdHRyaWJ1dGVzW1wiYWN0aW9uXCJdKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgXCJDTElDS1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RyaWdnZXIgb24gZXZlcnkgY2xpY2tcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2sgPSBvdXRjb21lLmlkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkRPVUJMRS1DTElDS1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYmxDbGljayA9IG91dGNvbWUuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBvdXRjb21lLmF0dHJpYnV0ZXNbXCJpY29uXCJdIHx8IFwid3JlbmNoXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBcImdseXBoaWNvbiBnbHlwaGljb24tXCIgKyBpY29uICsgXCIgZXQtYnV0dG9uLWJhci1idXR0b25cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IDxzcGFuIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBvbkNsaWNrPXt0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcywgb3V0Y29tZS5pZCl9IHRpdGxlPXtvdXRjb21lLmxhYmVsfT48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd0J1dHRvbnMucHVzaChidXR0b24pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbGFiZWwgOiBhbnk7XHJcbiAgICAgICAgdmFyIGxibCA6IGFueSA9IG51bGw7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmxhYmVsICYmIGZsb3dNb2RlbC5sYWJlbC5sZW5ndGg+MClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxibCA9IDxzcGFuPntmbG93TW9kZWwubGFiZWx9PC9zcGFuPjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxhYmVsID0gPGRpdiBjbGFzc05hbWU9XCJldC1jYXB0aW9uLWRpdlwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZXQtY2FwdGlvblwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7bGJsfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZXQtYnV0dG9uLWJhclwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7dG9wYnV0dG9uc31cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIFxyXG5cclxuXHJcbiAgICAgICAgdmFyIGhlYWRlcnMgPSBbXTtcclxuICAgICAgICB2YXIgcm93cyA9IFtdO1xyXG4gICAgICAgIHZhciBjb2xzIDogYW55ID0gW107XHJcbiAgICAgICAgdmFyIGNvbERlZiA6IGFueTtcclxuICAgICAgICB2YXIgcG9zID0gMDtcclxuICAgICAgICB2YXIgcm93IDogYW55O1xyXG4gICAgICAgIHZhciByb3dJZCA6IGFueTtcclxuICAgICAgICB2YXIgdmFscyA9IFtdO1xyXG5cclxuICAgICAgICAvL2hlYWRlciByb3dcclxuICAgICAgICAvLyBhZGQgYnV0dG9uIHNwYWNlciBpZiBuZWVkZWRcclxuICAgICAgICAvL2lmIHRoZXJlIGFyZSBidXR0b25zIHRoZW4gYWRkIGJsYW5rIGhlYWRlclxyXG4gICAgICAgIGlmKHJvd0J1dHRvbnMgJiYgcm93QnV0dG9ucy5sZW5ndGggPiAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaGVhZGVycy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1oZWFkZXJcIj48L3RkPik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZvciAocG9zID0gMDsgcG9zIDwgZmxvd01vZGVsLmNvbHVtbnMubGVuZ3RoIDsgcG9zKyspXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBjb2xOYW1lID0gZmxvd01vZGVsLmNvbHVtbnNbcG9zXS5kZXZlbG9wZXJOYW1lO1xyXG4gICAgICAgICAgICB2YXIgc29ydEljb24gOiBhbnk7XHJcblxyXG4gICAgICAgICAgICBpZih0aGlzLnNvcnRJdGVtICYmIHRoaXMuc29ydEl0ZW09PWNvbE5hbWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc29ydERpcmVjdGlvbiA9PSBcIkRFU0NcIilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzb3J0SWNvbiA9IDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tYXJyb3ctZG93blwiPjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzb3J0SWNvbiA9IDxzcGFuIGNsYXNzTmFtZT1cImdseXBoaWNvbiBnbHlwaGljb24tYXJyb3ctdXBcIj48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzb3J0SWNvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29sc1tmbG93TW9kZWwuY29sdW1uc1twb3NdLmRldmVsb3Blck5hbWVdID0gZmxvd01vZGVsLmNvbHVtbnNbcG9zXTtcclxuXHJcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSA8dGggY2xhc3NOYW1lPVwiZXQtdGFibGUtaGVhZGVyXCIgZGF0YS1jb2x1bW4tbmFtZT17Y29sTmFtZX0gb25DbGljaz17dGhpcy5zb3J0LmJpbmQodGhpcyl9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7J2Zsb2F0JzogJ2xlZnQnfX0+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPntmbG93TW9kZWwuY29sdW1uc1twb3NdLmxhYmVsfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPXt7J2Zsb2F0JzogJ3JpZ2h0J319PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c29ydEljb259XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGg+O1xyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGhlYWRlcnMucHVzaChoZWFkZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9ib2R5XHJcbiAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCBmbG93TW9kZWwub2JqZWN0RGF0YS5sZW5ndGggOyBwb3MrKylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJvdz1mbG93TW9kZWwub2JqZWN0RGF0YVtwb3NdO1xyXG5cclxuICAgICAgICAgICAgcm93SWQgPSBtYW55d2hvLnV0aWxzLmdldE9iamVjdERhdGFQcm9wZXJ0eShyb3cucHJvcGVydGllcywgdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIHZhbHMgPSBbXTtcclxuICAgICAgICAgICAgdmFscy5wdXNoKDx0ZCBjbGFzc05hbWU9XCJldC10YWJsZS1jZWxsXCI+e3Jvd0J1dHRvbnN9PC90ZD4pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9yKHZhciBpUG9zID0gMCA7IGlQb3MgPCByb3cucHJvcGVydGllcy5sZW5ndGggOyBpUG9zKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGNvbERlZiA9IGNvbHNbcm93LnByb3BlcnRpZXNbaVBvc10uZGV2ZWxvcGVyTmFtZV07XHJcbiAgICAgICAgICAgICAgICBpZiggY29sRGVmICYmIGNvbERlZi5pc0Rpc3BsYXlWYWx1ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxzLnB1c2goPHRkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWNlbGxcIj57cm93LnByb3BlcnRpZXNbaVBvc10uY29udGVudFZhbHVlfTwvdGQ+KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IFwiZXQtdGFibGUtcm93XCI7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRJdGVtICYmIHRoaXMuc2VsZWN0ZWRJdGVtPT1yb3dJZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lICs9IFwiIGV0LXRhYmxlLXJvdy1zZWxlY3RlZFwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgciA9IDx0ciBjbGFzc05hbWU9e2NsYXNzTmFtZX0gZGF0YS1yb3dJZD17cm93SWR9IGRhdGEtb2JqZWN0RGF0YT17cm93fSBvbkNsaWNrPXt0aGlzLnNlbGVjdFJvdy5iaW5kKHRoaXMpfSBvbkRvdWJsZUNsaWNrPXt0aGlzLnRyaWdnZXJPdXRjb21lLmJpbmQodGhpcyxkYmxDbGljayl9Pnt2YWxzfTwvdHI+O1xyXG4gICAgICAgICAgICAvL3Iuc2V0QXR0cmlidXRlKCdyb3dJZCcscm93SWQpO1xyXG4gICAgICAgICAgICByb3dzLnB1c2gocik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciB0YWJsZSA6IGFueSA9ICAgPGRpdiBjbGFzc05hbWU9XCJldC10YWJsZS1kaXZcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3NOYW1lPVwiZXQtdGFibGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkIGNsYXNzTmFtZT1cImV0LXRhYmxlLWhlYWRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzc05hbWU9XCJldC10YWJsZS1oZWFkZXItcm93XCI+e2hlYWRlcnN9PC90cj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5IGNsYXNzTmFtZT1cImV0LXRhYmxlLWJvZHlcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyb3dzfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuXHJcblxyXG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImV0XCI+XHJcbiAgICAgICAgICAgICAgICAgICAge2xhYmVsfVxyXG4gICAgICAgICAgICAgICAgICAgIHt0YWJsZX1cclxuICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICB9XHJcblxyXG4gICAgc2VsZWN0Um93KGV2ZW50IDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRJdGVtPWV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJvd0lkJyk7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGRvdWJsZUNsaWNrUm93KGV2ZW50IDogYW55KVxyXG4gICAge1xyXG4gICAgICAgIHZhciByb3dJZD1ldmVudC5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpIHx8IGV2ZW50LmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1yb3dJZCcpOztcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHJvd0tleUZpZWxkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpO1xyXG5cclxuICAgICAgICB2YXIgb2JqZWN0RGF0YT10aGlzLmdldE9iamVjdERhdGFCeUtleShmbG93TW9kZWwub2JqZWN0RGF0YSwgcm93S2V5RmllbGQsIHJvd0lkKTtcclxuXHJcbiAgICAgICAgLy9jbG9uZSBkYXRhXHJcblx0XHRvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3REYXRhKSk7XHJcblx0XHRvYmplY3REYXRhLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG5cdFx0dmFyIG5ld1N0YXRlID0ge1xyXG5cdFx0XHRvYmplY3REYXRhOiBbb2JqZWN0RGF0YV1cclxuXHRcdH07XHJcblx0XHRcclxuXHRcdG1hbnl3aG8uc3RhdGUuc2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIG5ld1N0YXRlLCB0aGlzLmZsb3dLZXksIHRydWUpO1xyXG5cclxuICAgICAgICBpZihvYmplY3REYXRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGRvdWJsZUNsaWNrT3V0Y29tZUlkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJEb3VibGUgQ2xpY2sgT3V0Y29tZSBJZFwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmKGRvdWJsZUNsaWNrT3V0Y29tZUlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZShkb3VibGVDbGlja091dGNvbWVJZCwgdGhpcy5mbG93S2V5KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZihvdXRjb21lKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hbnl3aG8uY29tcG9uZW50Lm9uT3V0Y29tZShvdXRjb21lLCBudWxsICwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJpZ2dlck91dGNvbWUob3V0Y29tZUlkIDogYW55LCBldmVudCA6IGFueSlcclxuICAgIHtcclxuICAgICAgICB2YXIgcm93SWQ9ZXZlbnQuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKSB8fCBldmVudC5jdXJyZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcm93SWQnKTtcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIHJvd0tleUZpZWxkID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJSb3cgS2V5XCIpO1xyXG5cclxuICAgICAgICB2YXIgb2JqZWN0RGF0YT10aGlzLmdldE9iamVjdERhdGFCeUtleShmbG93TW9kZWwub2JqZWN0RGF0YSwgcm93S2V5RmllbGQsIHJvd0lkKTtcclxuXHJcbiAgICAgICAgLy9jbG9uZSBkYXRhXHJcblx0XHRvYmplY3REYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmplY3REYXRhKSk7XHJcblx0XHRvYmplY3REYXRhLmlzU2VsZWN0ZWQgPSB0cnVlO1xyXG5cdFx0dmFyIG5ld1N0YXRlID0ge1xyXG5cdFx0XHRvYmplY3REYXRhOiBbb2JqZWN0RGF0YV1cclxuXHRcdH07XHJcblx0XHRcclxuXHRcdG1hbnl3aG8uc3RhdGUuc2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIG5ld1N0YXRlLCB0aGlzLmZsb3dLZXksIHRydWUpO1xyXG5cclxuICAgICAgICBpZihvYmplY3REYXRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYob3V0Y29tZUlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3V0Y29tZSA9IG1hbnl3aG8ubW9kZWwuZ2V0T3V0Y29tZShvdXRjb21lSWQsIHRoaXMuZmxvd0tleSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYob3V0Y29tZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYW55d2hvLmNvbXBvbmVudC5vbk91dGNvbWUob3V0Y29tZSwgbnVsbCAsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHNvcnQoZXZlbnQgOiBhbnkpXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5zb3J0SXRlbSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNvbHVtbi1uYW1lJyk7XHJcbiAgICAgICAgaWYodGhpcy5zb3J0RGlyZWN0aW9uICYmIHRoaXMuc29ydERpcmVjdGlvbiA9PSBcIkFTQ1wiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zb3J0RGlyZWN0aW9uPVwiREVTQ1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb249XCJBU0NcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldE9iamVjdERhdGFCeUtleShvYmplY3REYXRhIDogYW55LCBmaWVsZE5hbWUgOiBzdHJpbmcsIHZhbHVlIDogc3RyaW5nKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBvZCA6IGFueTtcclxuICAgICAgICB2YXIgdmFsIDogYW55O1xyXG4gICAgICAgIC8vbG9vcCBvdmVyIGRhdGEgaXRlbXNcclxuICAgICAgICBmb3IodmFyIHBvcyA9IDAgOyBwb3MgPCBvYmplY3REYXRhLmxlbmd0aDsgcG9zKyspXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBvZCA9IG9iamVjdERhdGFbcG9zXTtcclxuICAgICAgICAgICAgdmFsID0gbWFueXdoby51dGlscy5nZXRPYmplY3REYXRhUHJvcGVydHkob2QucHJvcGVydGllcywgZmllbGROYW1lKS5jb250ZW50VmFsdWU7XHJcbiAgICAgICAgICAgIGlmKHZhbD09dmFsdWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBvZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIFxyXG59XHJcblxyXG5tYW55d2hvLmNvbXBvbmVudC5yZWdpc3RlcignRW5oYW5jZWRUYWJsZScsIEVuaGFuY2VkVGFibGUpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgRW5oYW5jZWRUYWJsZTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvRW5oYW5jZWRUYWJsZS50c3giLCJtb2R1bGUuZXhwb3J0cyA9IFJlYWN0O1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiUmVhY3RcIlxuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9